<?xml version="1.0" encoding="UTF-8"?>
<exp:Export Version="3.0"
    xmlns:L7p="http://www.layer7tech.com/ws/policy"
    xmlns:exp="http://www.layer7tech.com/ws/policy/export" xmlns:wsp="http://schemas.xmlsoap.org/ws/2002/12/policy">
    <exp:References>
        <IncludedPolicyReference
            RefType="com.l7tech.console.policy.exporter.IncludedPolicyReference"
            guid="9bb870ad-0b68-47c6-a7ba-4c1eff19a531" included="true"
            name="Legacy - Escaper" soap="false" type="INCLUDE_FRAGMENT">
            <wsp:Policy xmlns:L7p="http://www.layer7tech.com/ws/policy" xmlns:wsp="http://schemas.xmlsoap.org/ws/2002/12/policy">
                <wsp:All wsp:Usage="Required">
                    <L7p:CommentAssertion>
                        <L7p:Comment stringValue="*************************************************************************"/>
                    </L7p:CommentAssertion>
                    <L7p:CommentAssertion>
                        <L7p:Comment stringValue="**Legacy  Escaper"/>
                    </L7p:CommentAssertion>
                    <L7p:CommentAssertion>
                        <L7p:Comment stringValue="** "/>
                    </L7p:CommentAssertion>
                    <L7p:CommentAssertion>
                        <L7p:Comment stringValue="** Escape request/response used by regular expession"/>
                    </L7p:CommentAssertion>
                    <L7p:CommentAssertion>
                        <L7p:Comment stringValue="** "/>
                    </L7p:CommentAssertion>
                    <L7p:CommentAssertion>
                        <L7p:Comment stringValue="*************************************************************************"/>
                    </L7p:CommentAssertion>
                    <L7p:AuditDetailAssertion>
                        <L7p:Detail stringValue="in &lt;&lt;&lt; Policy Fragment: Legacy - Escaper"/>
                    </L7p:AuditDetailAssertion>
                    <L7p:SetVariable>
                        <L7p:Base64Expression stringValue="JHtqZGJjUXVlcnkucmV0dXJuX3ZhbHVlfQ=="/>
                        <L7p:ContentType stringValue="text/xml; charset=utf-8"/>
                        <L7p:DataType variableDataType="message"/>
                        <L7p:Enabled booleanValue="false"/>
                        <L7p:VariableToSet stringValue="responseOut"/>
                    </L7p:SetVariable>
                    <L7p:Regex>
                        <L7p:AutoTarget booleanValue="false"/>
                        <L7p:OtherTargetMessageVariable stringValue="responseOut"/>
                        <L7p:Regex stringValue="&amp;"/>
                        <L7p:RegexName stringValue="Replace &amp; with &amp;amp;"/>
                        <L7p:Replace booleanValue="true"/>
                        <L7p:Replacement stringValue="&amp;amp;"/>
                        <L7p:Target target="OTHER"/>
                    </L7p:Regex>
                    <L7p:Regex>
                        <L7p:AutoTarget booleanValue="false"/>
                        <L7p:OtherTargetMessageVariable stringValue="responseOut"/>
                        <L7p:Regex stringValue="&quot;"/>
                        <L7p:RegexName stringValue="Replace &quot; with &amp;quot;"/>
                        <L7p:Replace booleanValue="true"/>
                        <L7p:Replacement stringValue="&amp;quot;"/>
                        <L7p:Target target="OTHER"/>
                    </L7p:Regex>
                    <L7p:Regex>
                        <L7p:AutoTarget booleanValue="false"/>
                        <L7p:OtherTargetMessageVariable stringValue="responseOut"/>
                        <L7p:Regex stringValue="'"/>
                        <L7p:RegexName stringValue="Replace ' with &amp;apos;"/>
                        <L7p:Replace booleanValue="true"/>
                        <L7p:Replacement stringValue="&amp;apos;"/>
                        <L7p:Target target="OTHER"/>
                    </L7p:Regex>
                    <L7p:Regex>
                        <L7p:AutoTarget booleanValue="false"/>
                        <L7p:OtherTargetMessageVariable stringValue="responseOut"/>
                        <L7p:Regex stringValue="&lt;"/>
                        <L7p:RegexName stringValue="Replace &lt; with &amp;lt;"/>
                        <L7p:Replace booleanValue="true"/>
                        <L7p:Replacement stringValue="&amp;lt;"/>
                        <L7p:Target target="OTHER"/>
                    </L7p:Regex>
                    <L7p:Regex>
                        <L7p:AutoTarget booleanValue="false"/>
                        <L7p:OtherTargetMessageVariable stringValue="responseOut"/>
                        <L7p:Regex stringValue=">"/>
                        <L7p:RegexName stringValue="Replace > with &amp;gt;"/>
                        <L7p:Replace booleanValue="true"/>
                        <L7p:Replacement stringValue="&amp;gt;"/>
                        <L7p:Target target="OTHER"/>
                    </L7p:Regex>
                    <L7p:HardcodedResponse>
                        <L7p:Base64ResponseBody stringValue="JHtyZXNwb25zZU91dC5tYWlucGFydH0="/>
                        <L7p:Enabled booleanValue="false"/>
                    </L7p:HardcodedResponse>
                    <L7p:AuditDetailAssertion>
                        <L7p:Detail stringValue="out >>> Policy Fragment: Legacy - Escaper"/>
                    </L7p:AuditDetailAssertion>
                </wsp:All>
            </wsp:Policy>
        </IncludedPolicyReference>
        <IncludedPolicyReference
            RefType="com.l7tech.console.policy.exporter.IncludedPolicyReference"
            guid="317ddcb2-f89d-4db4-ae1a-0e29ddef31c8" included="true"
            name="Legacy - Get Response by ID" soap="true" type="INCLUDE_FRAGMENT">
            <wsp:Policy xmlns:L7p="http://www.layer7tech.com/ws/policy" xmlns:wsp="http://schemas.xmlsoap.org/ws/2002/12/policy">
                <wsp:All wsp:Usage="Required">
                    <L7p:CommentAssertion>
                        <L7p:Comment stringValue="*************************************************************************"/>
                    </L7p:CommentAssertion>
                    <L7p:CommentAssertion>
                        <L7p:Comment stringValue="** Legacy Standard Get Response by ID"/>
                    </L7p:CommentAssertion>
                    <L7p:CommentAssertion>
                        <L7p:Comment stringValue="**  Written by Eli K on 006/08/13"/>
                    </L7p:CommentAssertion>
                    <L7p:CommentAssertion>
                        <L7p:Comment stringValue="** Check if response is in cache and retrieve if valid, otherwise fetch from DB, otherwise fail"/>
                    </L7p:CommentAssertion>
                    <L7p:CommentAssertion>
                        <L7p:Comment stringValue="**  Expect : ${partner.requestId}, return ${output}"/>
                    </L7p:CommentAssertion>
                    <L7p:CommentAssertion>
                        <L7p:Comment stringValue="*************************************************************************"/>
                    </L7p:CommentAssertion>
                    <L7p:AuditDetailAssertion>
                        <L7p:Detail stringValue="Policy Fragment: Legacy - Get Response by ID"/>
                    </L7p:AuditDetailAssertion>
                    <wsp:All wsp:Usage="Required">
                        <wsp:OneOrMore wsp:Usage="Required">
                            <wsp:All wsp:Usage="Required">
                                <L7p:AuditDetailAssertion>
                                    <L7p:Detail stringValue="using cache ${partner.requestId}-${gateway.partner.environment}-servicename"/>
                                </L7p:AuditDetailAssertion>
                                <L7p:RemoteCacheLookup>
                                    <L7p:CacheEntryKey stringValue="${request.http.parameter.requestID}-${gateway.partner.environment}-servicename"/>
                                    <L7p:Enabled booleanValue="false"/>
                                    <L7p:OtherTargetMessageVariable stringValue="jdbcQuery.serviceName"/>
                                    <L7p:RemoteCacheId longValue="499613696"/>
                                    <L7p:Target target="OTHER"/>
                                </L7p:RemoteCacheLookup>
                                <L7p:RemoteCacheLookup>
                                    <L7p:CacheEntryKey stringValue="${partner.requestId}-${gateway.partner.environment}-servicename"/>
                                    <L7p:OtherTargetMessageVariable stringValue="jdbcQuery.serviceName.mainpart"/>
                                    <L7p:RemoteCacheId longValue="499613696"/>
                                    <L7p:Target target="OTHER"/>
                                </L7p:RemoteCacheLookup>
                                <L7p:ComparisonAssertion>
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Expression1 stringValue="${jdbcQuery.serviceName.mainpart}"/>
                                    <L7p:Operator operatorNull="null"/>
                                    <L7p:Predicates predicates="included">
                                    <L7p:item dataType="included">
                                    <L7p:Type variableDataType="string"/>
                                    </L7p:item>
                                    <L7p:item stringLength="included">
                                    <L7p:Max intValue="-1"/>
                                    <L7p:Min intValue="3"/>
                                    </L7p:item>
                                    </L7p:Predicates>
                                </L7p:ComparisonAssertion>
                                <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="JHtqZGJjUXVlcnkuc2VydmljZU5hbWUubWFpbnBhcnR9"/>
                                    <L7p:VariableToSet stringValue="jdbcQuery.serviceName"/>
                                </L7p:SetVariable>
                            </wsp:All>
                            <wsp:All wsp:Usage="Required">
                                <L7p:AuditDetailAssertion>
                                    <L7p:Detail stringValue="Cache failed, using JDBC"/>
                                </L7p:AuditDetailAssertion>
                                <L7p:AuditDetailAssertion>
                                    <L7p:Detail stringValue="SELECT REQ_SERVICE_NAME AS serviceName FROM REQUESTS WHERE REQ_ID=${request.http.parameter.requestID}"/>
                                </L7p:AuditDetailAssertion>
                                <L7p:JdbcQuery>
                                    <L7p:ConnectionName stringValue="Tracer Database"/>
                                    <L7p:MaxRecords intValue="1"/>
                                    <L7p:QueryTimeout stringValue="2"/>
                                    <L7p:SqlQuery stringValue="SELECT REQ_SERVICE_NAME AS serviceName FROM REQUESTS WHERE REQ_ID=${request.http.parameter.requestID}"/>
                                </L7p:JdbcQuery>
                                <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="JHtqZGJjUXVlcnkuc2VydmljZU5hbWV9"/>
                                    <L7p:VariableToSet stringValue="jdbcQuery.serviceName"/>
                                </L7p:SetVariable>
                                <L7p:AuditDetailAssertion>
                                    <L7p:Detail stringValue="Found something!: ${jdbcquery.servicename}"/>
                                </L7p:AuditDetailAssertion>
                            </wsp:All>
                        </wsp:OneOrMore>
                        <L7p:assertionComment>
                            <L7p:Properties mapValue="included">
                                <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="  // Get service name by requestID"/>
                                </L7p:entry>
                            </L7p:Properties>
                        </L7p:assertionComment>
                    </wsp:All>
                    <wsp:OneOrMore wsp:Usage="Required">
                        <wsp:All wsp:Usage="Required">
                            <L7p:AuditDetailAssertion>
                                <L7p:Detail stringValue="Getting payload from cache. Key: ${partner.requestId}-${gateway.partner.environment}-response"/>
                            </L7p:AuditDetailAssertion>
                            <L7p:RemoteCacheLookup>
                                <L7p:CacheEntryKey stringValue="${partner.requestId}-${gateway.partner.environment}-response"/>
                                <L7p:OtherTargetMessageVariable stringValue="payload"/>
                                <L7p:RemoteCacheId longValue="499613696"/>
                                <L7p:Target target="OTHER"/>
                            </L7p:RemoteCacheLookup>
                            <wsp:OneOrMore wsp:Usage="Required">
                                <wsp:All wsp:Usage="Required">
                                    <L7p:ComparisonAssertion>
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Expression1 stringValue="${payload.mainpart}"/>
                                    <L7p:ExpressionIsVariable booleanValue="false"/>
                                    <L7p:Operator operatorNull="null"/>
                                    <L7p:Predicates predicates="included">
                                    <L7p:item dataType="included">
                                    <L7p:Type variableDataType="string"/>
                                    </L7p:item>
                                    <L7p:item binary="included">
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Operator operator="EMPTY"/>
                                    <L7p:RightValue stringValue="asdf"/>
                                    </L7p:item>
                                    </L7p:Predicates>
                                    </L7p:ComparisonAssertion>
                                    <L7p:AuditDetailAssertion>
                                    <L7p:Detail stringValue="Empty payload in cache. payload.mainpart=:${payload.mainpart}"/>
                                    </L7p:AuditDetailAssertion>
                                    <L7p:LookupDynamicContextVariables>
                                    <L7p:FailOnNotFound booleanValue="false"/>
                                    <L7p:SourceVariable stringValue="gateway.partner.configuration.${jdbcQuery.serviceName}.eta"/>
                                    <L7p:TargetDataType variableDataType="string"/>
                                    <L7p:TargetOutputVariablePrefix stringValue="clusterProp"/>
                                    </L7p:LookupDynamicContextVariables>
                                    <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="PGV0YT4ke2NsdXN0ZXJQcm9wfTwvZXRhPg=="/>
                                    <L7p:VariableToSet stringValue="output"/>
                                    </L7p:SetVariable>
                                    <L7p:AuditDetailAssertion>
                                    <L7p:Detail stringValue="****** return ${output}"/>
                                    </L7p:AuditDetailAssertion>
                                    <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue=" //payload found, but empty"/>
                                    </L7p:entry>
                                    </L7p:Properties>
                                    </L7p:assertionComment>
                                </wsp:All>
                                <wsp:All wsp:Usage="Required">
                                    <L7p:AuditDetailAssertion>
                                    <L7p:Detail stringValue="Found payload in cache. payload.mainpart=:${payload.mainpart}"/>
                                    </L7p:AuditDetailAssertion>
                                    <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="JHtwYXlsb2FkLm1haW5wYXJ0fQ=="/>
                                    <L7p:VariableToSet stringValue="responseOut"/>
                                    </L7p:SetVariable>
                                    <L7p:Include>
                                    <L7p:PolicyGuid stringValue="9bb870ad-0b68-47c6-a7ba-4c1eff19a531"/>
                                    </L7p:Include>
                                    <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="PHJlc3BvbnNlPiR7cmVzcG9uc2VPdXR9PC9yZXNwb25zZT4="/>
                                    <L7p:VariableToSet stringValue="output"/>
                                    </L7p:SetVariable>
                                    <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="dHJ1ZQ=="/>
                                    <L7p:VariableToSet stringValue="responseReceived"/>
                                    </L7p:SetVariable>
                                    <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue=" //payload found"/>
                                    </L7p:entry>
                                    </L7p:Properties>
                                    </L7p:assertionComment>
                                </wsp:All>
                                <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue=" // If still empty, return eta"/>
                                    </L7p:entry>
                                    </L7p:Properties>
                                </L7p:assertionComment>
                            </wsp:OneOrMore>
                            <L7p:assertionComment>
                                <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// Check cache for response message"/>
                                    </L7p:entry>
                                </L7p:Properties>
                            </L7p:assertionComment>
                        </wsp:All>
                        <wsp:All wsp:Usage="Required">
                            <L7p:JdbcQuery>
                                <L7p:AssertionFailureEnabled booleanValue="false"/>
                                <L7p:ConnectionName stringValue="Tracer Database"/>
                                <L7p:MaxRecords intValue="1"/>
                                <L7p:SqlQuery stringValue="SELECT REQ_XML_REPLY AS payload FROM REQUESTS WHERE REQ_ID=${partner.requestid}"/>
                            </L7p:JdbcQuery>
                            <wsp:OneOrMore wsp:Usage="Required">
                                <wsp:All wsp:Usage="Required">
                                    <L7p:ComparisonAssertion>
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Expression1 stringValue="${jdbcQuery.queryresult.count}"/>
                                    <L7p:ExpressionIsVariable booleanValue="false"/>
                                    <L7p:Operator operatorNull="null"/>
                                    <L7p:Predicates predicates="included">
                                    <L7p:item dataType="included">
                                    <L7p:Type variableDataType="int"/>
                                    </L7p:item>
                                    <L7p:item binary="included">
                                    <L7p:RightValue stringValue="0"/>
                                    </L7p:item>
                                    </L7p:Predicates>
                                    </L7p:ComparisonAssertion>
                                    <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="PHJlcXVlc3Qtbm90LWZvdW5kLz4="/>
                                    <L7p:VariableToSet stringValue="output"/>
                                    </L7p:SetVariable>
                                    <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// Request not found"/>
                                    </L7p:entry>
                                    </L7p:Properties>
                                    </L7p:assertionComment>
                                </wsp:All>
                                <wsp:All wsp:Usage="Required">
                                    <L7p:ComparisonAssertion>
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Expression1 stringValue="${jdbcQuery.payload}"/>
                                    <L7p:ExpressionIsVariable booleanValue="false"/>
                                    <L7p:Operator operatorNull="null"/>
                                    <L7p:Predicates predicates="included">
                                    <L7p:item dataType="included">
                                    <L7p:Type variableDataType="string"/>
                                    </L7p:item>
                                    <L7p:item binary="included">
                                    <L7p:Operator operator="EMPTY"/>
                                    <L7p:RightValue stringValue=""/>
                                    </L7p:item>
                                    </L7p:Predicates>
                                    </L7p:ComparisonAssertion>
                                    <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="PGV0YT4ke2NvbmZpZy5ldGF9PC9ldGE+"/>
                                    <L7p:VariableToSet stringValue="output"/>
                                    </L7p:SetVariable>
                                    <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// Not ready yet"/>
                                    </L7p:entry>
                                    </L7p:Properties>
                                    </L7p:assertionComment>
                                </wsp:All>
                                <wsp:All wsp:Usage="Required">
                                    <L7p:AuditDetailAssertion>
                                    <L7p:Detail stringValue="Found payload in Tracing database"/>
                                    </L7p:AuditDetailAssertion>
                                    <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="JHtqZGJjUXVlcnkucGF5bG9hZH0="/>
                                    <L7p:VariableToSet stringValue="responseOut"/>
                                    </L7p:SetVariable>
                                    <L7p:Include>
                                    <L7p:PolicyGuid stringValue="9bb870ad-0b68-47c6-a7ba-4c1eff19a531"/>
                                    </L7p:Include>
                                    <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="PHJlc3BvbnNlPiR7cmVzcG9uc2VPdXR9PC9yZXNwb25zZT4="/>
                                    <L7p:VariableToSet stringValue="output"/>
                                    </L7p:SetVariable>
                                    <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="dHJ1ZQ=="/>
                                    <L7p:VariableToSet stringValue="responseReceived"/>
                                    </L7p:SetVariable>
                                    <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// Response was found"/>
                                    </L7p:entry>
                                    </L7p:Properties>
                                    </L7p:assertionComment>
                                </wsp:All>
                                <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// Handle respone from Tracer DB"/>
                                    </L7p:entry>
                                    </L7p:Properties>
                                </L7p:assertionComment>
                            </wsp:OneOrMore>
                            <L7p:assertionComment>
                                <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// Get response from Tracing DB"/>
                                    </L7p:entry>
                                </L7p:Properties>
                            </L7p:assertionComment>
                        </wsp:All>
                        <wsp:All wsp:Usage="Required">
                            <L7p:AuditDetailAssertion>
                                <L7p:Detail stringValue="Unable to query the tracer database"/>
                            </L7p:AuditDetailAssertion>
                            <L7p:SetVariable>
                                <L7p:Base64Expression stringValue="PHJlcXVlc3Qtbm90LWZvdW5kPk5vdCBpbiBjYWNoZSBhbmQgREIgcXVlcnkgZmFpbGVkPC9yZXF1ZXN0LW5vdC1mb3VuZD4="/>
                                <L7p:VariableToSet stringValue="output"/>
                            </L7p:SetVariable>
                            <L7p:assertionComment>
                                <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// Unable to query the tracer database"/>
                                    </L7p:entry>
                                </L7p:Properties>
                            </L7p:assertionComment>
                        </wsp:All>
                        <L7p:assertionComment>
                            <L7p:Properties mapValue="included">
                                <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue=" // Get response from cache, DB or send a NOT YET response"/>
                                </L7p:entry>
                            </L7p:Properties>
                        </L7p:assertionComment>
                    </wsp:OneOrMore>
                </wsp:All>
            </wsp:Policy>
        </IncludedPolicyReference>
        <RemoteCacheReference RefType="com.l7tech.external.assertions.remotecacheassertion.RemoteCacheReference">
            <OID>499613696</OID>
            <Name>RemoteCache</Name>
            <Classname>com.l7tech.external.assertions.remotecacheassertion.RemoteCacheEntity</Classname>
            <Type>memcached</Type>
            <Timeout>2</Timeout>
            <Properties>
                <Property mame="ports">vmmemc1:23000</Property>
                <Property mame="bucketSpecified">false</Property>
            </Properties>
        </RemoteCacheReference>
        <JdbcConnectionReference RefType="com.l7tech.console.policy.exporter.JdbcConnectionReference">
            <ConnectionName>Tracer Database</ConnectionName>
            <DriverClass>com.l7tech.jdbc.oracle.OracleDriver</DriverClass>
            <JdbcUrl>jdbc:l7tech:oracle://ifdb:1529;SID=ifprod</JdbcUrl>
            <UserName>ESB_RT_LOAD</UserName>
            <AdditionalProperties>
                <Property>
                    <Name>c3p0.idleConnectTestPeriod</Name>
                    <Value>600</Value>
                </Property>
                <Property>
                    <Name>c3p0.maxIdleTime</Name>
                    <Value>0</Value>
                </Property>
                <Property>
                    <Name>c3p0.maxIdleTimeExcessConnections</Name>
                    <Value>300</Value>
                </Property>
                <Property>
                    <Name>c3p0.preferredTestQuery</Name>
                    <Value>SELECT 1 FROM dual</Value>
                </Property>
                <Property>
                    <Name>enableCancelTimeout</Name>
                    <Value>true</Value>
                </Property>
            </AdditionalProperties>
        </JdbcConnectionReference>
        <IncludedPolicyReference
            RefType="com.l7tech.console.policy.exporter.IncludedPolicyReference"
            guid="f7faf570-d59b-454d-9a43-d963c760acb6" included="true"
            name="Legacy - Handle Final Response" soap="false" type="INCLUDE_FRAGMENT">
            <wsp:Policy xmlns:L7p="http://www.layer7tech.com/ws/policy" xmlns:wsp="http://schemas.xmlsoap.org/ws/2002/12/policy">
                <wsp:All wsp:Usage="Required">
                    <L7p:CommentAssertion>
                        <L7p:Comment stringValue="*************************************************************************"/>
                    </L7p:CommentAssertion>
                    <L7p:CommentAssertion>
                        <L7p:Comment stringValue="** Legacy Handle final response for receive"/>
                    </L7p:CommentAssertion>
                    <L7p:CommentAssertion>
                        <L7p:Comment stringValue="** "/>
                    </L7p:CommentAssertion>
                    <L7p:CommentAssertion>
                        <L7p:Comment stringValue="** look if theres eta or not, and handle appropriatly making the response"/>
                    </L7p:CommentAssertion>
                    <L7p:CommentAssertion>
                        <L7p:Comment stringValue="** "/>
                    </L7p:CommentAssertion>
                    <L7p:CommentAssertion>
                        <L7p:Comment stringValue="** "/>
                    </L7p:CommentAssertion>
                    <L7p:CommentAssertion>
                        <L7p:Comment stringValue="** Elik 02/09/13 "/>
                    </L7p:CommentAssertion>
                    <L7p:CommentAssertion>
                        <L7p:Comment stringValue="** "/>
                    </L7p:CommentAssertion>
                    <L7p:CommentAssertion>
                        <L7p:Comment stringValue="*************************************************************************"/>
                    </L7p:CommentAssertion>
                    <wsp:OneOrMore wsp:Usage="Required">
                        <wsp:All wsp:Usage="Required">
                            <L7p:ResponseXpathAssertion>
                                <L7p:VariablePrefix stringValue=""/>
                                <L7p:XmlMsgSrc stringValue="responseMsg"/>
                                <L7p:XpathExpression xpathExpressionValue="included">
                                    <L7p:Expression stringValue="//response"/>
                                    <L7p:Namespaces mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="s"/>
                                    <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                                    </L7p:entry>
                                    <L7p:entry>
                                    <L7p:key stringValue="ser"/>
                                    <L7p:value stringValue="http://www.orange.co.il/services"/>
                                    </L7p:entry>
                                    </L7p:Namespaces>
                                    <L7p:XpathVersion xpathVersion="XPATH_1_0"/>
                                </L7p:XpathExpression>
                            </L7p:ResponseXpathAssertion>
                            <L7p:AuditDetailAssertion>
                                <L7p:CustomLoggerSuffix stringValue="LogToSplunk"/>
                                <L7p:Detail stringValue="receiveLoop attempt=initial took=${request.elapsedTime}"/>
                                <L7p:LoggingOnly booleanValue="true"/>
                            </L7p:AuditDetailAssertion>
                            <L7p:HardcodedResponse>
                                <L7p:Base64ResponseBody stringValue="JHtyZXNwb25zZVhwYXRoLnJlc3VsdH0="/>
                                <L7p:EarlyResponse booleanValue="true"/>
                            </L7p:HardcodedResponse>
                            <L7p:HardcodedResponse>
                                <L7p:Base64ResponseBody stringValue="JHtmaW5hbFJlc3BvbnNlLm1haW5wYXJ0fQ=="/>
                                <L7p:EarlyResponse booleanValue="true"/>
                                <L7p:Enabled booleanValue="false"/>
                            </L7p:HardcodedResponse>
                            <L7p:assertionComment>
                                <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// if the response has no ETA, return it simply"/>
                                    </L7p:entry>
                                </L7p:Properties>
                            </L7p:assertionComment>
                        </wsp:All>
                        <wsp:All wsp:Usage="Required">
                            <L7p:ResponseXpathAssertion>
                                <L7p:AssertionComment assertionComment="included">
                                    <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue=" //xpath the request to get etaForDivision"/>
                                    </L7p:entry>
                                    </L7p:Properties>
                                </L7p:AssertionComment>
                                <L7p:VariablePrefix stringValue="eta"/>
                                <L7p:XmlMsgSrc stringValue="responseMsg"/>
                                <L7p:XpathExpression xpathExpressionValue="included">
                                    <L7p:Expression stringValue="//eta/text()"/>
                                    <L7p:Namespaces mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="s"/>
                                    <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                                    </L7p:entry>
                                    <L7p:entry>
                                    <L7p:key stringValue="ser"/>
                                    <L7p:value stringValue="http://www.orange.co.il/services"/>
                                    </L7p:entry>
                                    </L7p:Namespaces>
                                    <L7p:XpathVersion xpathVersion="XPATH_1_0"/>
                                </L7p:XpathExpression>
                            </L7p:ResponseXpathAssertion>
                            <L7p:SetVariable>
                                <L7p:Base64Expression stringValue="JHtldGEucmVzdWx0fQ=="/>
                                <L7p:DataType variableDataType="int"/>
                                <L7p:VariableToSet stringValue="etaForDivisionInt"/>
                            </L7p:SetVariable>
                            <L7p:AuditDetailAssertion>
                                <L7p:Detail stringValue="CP: ${gateway.partner.configuration.consumerTimeout}000"/>
                            </L7p:AuditDetailAssertion>
                            <wsp:OneOrMore wsp:Usage="Required">
                                <wsp:All wsp:Usage="Required">
                                    <L7p:ComparisonAssertion>
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Expression1 stringValue="${request.http.parameter.timeout}"/>
                                    <L7p:ExpressionIsVariable booleanValue="false"/>
                                    <L7p:Operator operatorNull="null"/>
                                    <L7p:Predicates predicates="included">
                                    <L7p:item dataType="included">
                                    <L7p:Type variableDataType="int"/>
                                    </L7p:item>
                                    <L7p:item stringLength="included">
                                    <L7p:Max intValue="-1"/>
                                    <L7p:Min intValue="1"/>
                                    </L7p:item>
                                    </L7p:Predicates>
                                    </L7p:ComparisonAssertion>
                                    <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLnRpbWVvdXR9MDAw"/>
                                    <L7p:DataType variableDataType="int"/>
                                    <L7p:VariableToSet stringValue="consumerTimeout"/>
                                    </L7p:SetVariable>
                                    <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// Check if a timeout parameter is passed by the request."/>
                                    </L7p:entry>
                                    </L7p:Properties>
                                    </L7p:assertionComment>
                                </wsp:All>
                                <L7p:SetVariable>
                                    <L7p:AssertionComment assertionComment="included">
                                    <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// if the above is not set then use default setting from system"/>
                                    </L7p:entry>
                                    </L7p:Properties>
                                    </L7p:AssertionComment>
                                    <L7p:Base64Expression stringValue="JHtnYXRld2F5LnBhcnRuZXIuY29uZmlndXJhdGlvbi5jb25zdW1lclRpbWVvdXR9MDAw"/>
                                    <L7p:DataType variableDataType="int"/>
                                    <L7p:VariableToSet stringValue="consumerTimeout"/>
                                </L7p:SetVariable>
                                <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// If timeout supplied - use it. ELSE - use default"/>
                                    </L7p:entry>
                                    </L7p:Properties>
                                </L7p:assertionComment>
                            </wsp:OneOrMore>
                            <L7p:AuditDetailAssertion>
                                <L7p:Detail stringValue="Recieve - consumerTimeout_Int: ${consumerTimeout_Int}"/>
                            </L7p:AuditDetailAssertion>
                            <L7p:SetVariable>
                                <L7p:Base64Expression stringValue="JHtnYXRld2F5LnBhcnRuZXIuY29uZmlndXJhdGlvbi5ldGFEaXZpc29yfQ=="/>
                                <L7p:DataType variableDataType="int"/>
                                <L7p:VariableToSet stringValue="etaDivisor_Int"/>
                            </L7p:SetVariable>
                            <L7p:AuditDetailAssertion>
                                <L7p:Detail stringValue="Recieve - etaDvisor_Int: ${etaDivisor_Int}"/>
                            </L7p:AuditDetailAssertion>
                            <L7p:EvaluateMathExpression>
                                <L7p:AssertionComment assertionComment="included">
                                    <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// calculate timeOutDivisor "/>
                                    </L7p:entry>
                                    </L7p:Properties>
                                </L7p:AssertionComment>
                                <L7p:Expression stringValue="${etaForDivisionInt}/${etaDivisor_Int}"/>
                                <L7p:OutputVariable stringValue="timeOutDivisor"/>
                            </L7p:EvaluateMathExpression>
                            <L7p:EvaluateMathExpression>
                                <L7p:AssertionComment assertionComment="included">
                                    <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// calculate iterations"/>
                                    </L7p:entry>
                                    </L7p:Properties>
                                </L7p:AssertionComment>
                                <L7p:Expression stringValue="${consumerTimeout}/${timeOutDivisor}"/>
                                <L7p:OutputVariable stringValue="iterators"/>
                            </L7p:EvaluateMathExpression>
                            <wsp:OneOrMore wsp:Usage="Required">
                                <wsp:All wsp:Usage="Required">
                                    <L7p:ComparisonAssertion>
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Expression1 stringValue="${iterators}"/>
                                    <L7p:ExpressionIsVariable booleanValue="false"/>
                                    <L7p:Operator operatorNull="null"/>
                                    <L7p:Predicates predicates="included">
                                    <L7p:item dataType="included">
                                    <L7p:Type variableDataType="int"/>
                                    </L7p:item>
                                    <L7p:item binary="included">
                                    <L7p:Operator operator="GT"/>
                                    <L7p:RightValue stringValue="${gateway.partner.max.iterations}"/>
                                    </L7p:item>
                                    </L7p:Predicates>
                                    </L7p:ComparisonAssertion>
                                    <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="JHtnYXRld2F5LnBhcnRuZXIubWF4Lml0ZXJhdGlvbnN9"/>
                                    <L7p:DataType variableDataType="int"/>
                                    <L7p:VariableToSet stringValue="iterators"/>
                                    </L7p:SetVariable>
                                </wsp:All>
                                <L7p:TrueAssertion/>
                                <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue=" // if iterators > max.iterators - use max.iterators"/>
                                    </L7p:entry>
                                    </L7p:Properties>
                                </L7p:assertionComment>
                            </wsp:OneOrMore>
                            <L7p:EvaluateMathExpression>
                                <L7p:AssertionComment assertionComment="included">
                                    <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// calculate delay"/>
                                    </L7p:entry>
                                    </L7p:Properties>
                                </L7p:AssertionComment>
                                <L7p:Expression stringValue="${consumerTimeout}/${iterators}"/>
                                <L7p:OutputVariable stringValue="delay"/>
                            </L7p:EvaluateMathExpression>
                            <L7p:SetVariable>
                                <L7p:AssertionComment assertionComment="included">
                                    <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="LEFT.COMMENT"/>
                                    <L7p:value stringValue="OVERRIDE - PLEASE FIX"/>
                                    </L7p:entry>
                                    </L7p:Properties>
                                </L7p:AssertionComment>
                                <L7p:Base64Expression stringValue="MTIwMA=="/>
                                <L7p:DataType variableDataType="int"/>
                                <L7p:Enabled booleanValue="false"/>
                                <L7p:VariableToSet stringValue="iterators"/>
                            </L7p:SetVariable>
                            <L7p:SetVariable>
                                <L7p:AssertionComment assertionComment="included">
                                    <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="LEFT.COMMENT"/>
                                    <L7p:value stringValue="OVERRIDE - PLEASE FIX"/>
                                    </L7p:entry>
                                    </L7p:Properties>
                                </L7p:AssertionComment>
                                <L7p:Base64Expression stringValue="MTAw"/>
                                <L7p:DataType variableDataType="int"/>
                                <L7p:Enabled booleanValue="false"/>
                                <L7p:VariableToSet stringValue="delay"/>
                            </L7p:SetVariable>
                            <L7p:SetVariable>
                                <L7p:Base64Expression stringValue="PHRpbWVzPiR7aXRlcmF0b3JzfTwvdGltZXM+"/>
                                <L7p:ContentType stringValue="text/xml; charset=utf-8"/>
                                <L7p:DataType variableDataType="message"/>
                                <L7p:VariableToSet stringValue="delayDataMsg"/>
                            </L7p:SetVariable>
                            <L7p:AuditDetailAssertion>
                                <L7p:Detail stringValueReference="inline"><![CDATA[Our vars:
etaForDivision - ${etaForDivisionInt}
consumerTimeout_Int - ${consumerTimeout_Int}
timeOutDivisor - ${timeOutDivisor}
iterators - ${iterators}
delayDataMsg - ${delayDataMsg.mainpart}]]></L7p:Detail>
                            </L7p:AuditDetailAssertion>
                            <L7p:AuditDetailAssertion>
                                <L7p:Detail stringValue="Doing XSL on ${DelayDatamsg.mainpart}"/>
                            </L7p:AuditDetailAssertion>
                            <L7p:XslTransformation>
                                <L7p:Direction intValue="-1"/>
                                <L7p:OtherTargetMessageVariable stringValue="delayDataMsg"/>
                                <L7p:ResourceInfo staticResourceInfo="included">
                                    <L7p:Document stringValueReference="inline"><![CDATA[<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">

  <xsl:template match="/times">

<xsl:variable name="count" select="'50'"/>
<xsl:call-template name="loop">
  <xsl:with-param name="i" select="number(1)"/>
  <xsl:with-param name="max" select="."/>
</xsl:call-template>             
                 
  </xsl:template>

<xsl:template name="loop">
  <xsl:param name="i"/>
  <xsl:param name="max"/>
  <xsl:if test="$i &lt;= $max">
      <xsl:text>,A</xsl:text>
      <xsl:call-template name="loop">
        <xsl:with-param name="i" select="$i + 1"/>
        <xsl:with-param name="max" select="$max"/>
      </xsl:call-template>
  </xsl:if>
</xsl:template>

</xsl:stylesheet>]]></L7p:Document>
                                </L7p:ResourceInfo>
                                <L7p:Target target="OTHER"/>
                                <L7p:TransformName stringValue=""/>
                                <L7p:XsltVersion stringValue="1.0"/>
                            </L7p:XslTransformation>
                            <L7p:AuditDetailAssertion>
                                <L7p:Detail stringValue="finished XSL on - ${delayDataMsg.mainpart}"/>
                            </L7p:AuditDetailAssertion>
                            <L7p:SetVariable>
                                <L7p:Base64Expression stringValue="JHtkZWxheURhdGFNc2cubWFpbnBhcnR9"/>
                                <L7p:VariableToSet stringValue="delayDataMsg"/>
                            </L7p:SetVariable>
                            <L7p:Regex>
                                <L7p:AutoTarget booleanValue="false"/>
                                <L7p:Enabled booleanValue="false"/>
                                <L7p:OtherTargetMessageVariable stringValue="delayDataMsg"/>
                                <L7p:Regex stringValue="&lt;?.*>, "/>
                                <L7p:RegexName stringValue="Remove prefix"/>
                                <L7p:Replace booleanValue="true"/>
                                <L7p:Replacement stringValue=""/>
                                <L7p:Target target="OTHER"/>
                            </L7p:Regex>
                            <L7p:AuditDetailAssertion>
                                <L7p:Detail stringValue="delayDataMsg - Afetr convert to String - ${delayDataMsg}"/>
                            </L7p:AuditDetailAssertion>
                            <L7p:SetVariable>
                                <L7p:Base64Expression stringValue="JHtkZWxheURhdGFNc2d9"/>
                                <L7p:VariableToSet stringValue="iterators"/>
                            </L7p:SetVariable>
                            <L7p:Split>
                                <L7p:InputVariable stringValue="iterators"/>
                                <L7p:OutputVariable stringValue="iterators"/>
                            </L7p:Split>
                            <L7p:AuditDetailAssertion>
                                <L7p:Detail stringValue="length - ${iterators.length}"/>
                            </L7p:AuditDetailAssertion>
                            <L7p:AuditDetailAssertion>
                                <L7p:Detail stringValue="iterators - ${iterators}"/>
                            </L7p:AuditDetailAssertion>
                            <L7p:SetVariable>
                                <L7p:Base64Expression stringValue="ZmFsc2U="/>
                                <L7p:VariableToSet stringValue="responseReceived"/>
                            </L7p:SetVariable>
                            <L7p:ForEachLoop L7p:Usage="Required"
                                loopVariable="iterators" variablePrefix="i">
                                <wsp:OneOrMore wsp:Usage="Required">
                                    <L7p:ComparisonAssertion>
                                    <L7p:AssertionComment assertionComment="included">
                                    <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// Continue if no response yet"/>
                                    </L7p:entry>
                                    </L7p:Properties>
                                    </L7p:AssertionComment>
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Expression1 stringValue="${responseReceived}"/>
                                    <L7p:MultivaluedComparison multivaluedComparison="FAIL"/>
                                    <L7p:Operator operatorNull="null"/>
                                    <L7p:Predicates predicates="included">
                                    <L7p:item dataType="included">
                                    <L7p:Type variableDataType="boolean"/>
                                    </L7p:item>
                                    <L7p:item binary="included">
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:RightValue stringValue="false"/>
                                    </L7p:item>
                                    </L7p:Predicates>
                                    </L7p:ComparisonAssertion>
                                    <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="dHJ1ZQ=="/>
                                    <L7p:VariableToSet stringValue="i.break"/>
                                    </L7p:SetVariable>
                                    <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// Break if a response was found"/>
                                    </L7p:entry>
                                    </L7p:Properties>
                                    </L7p:assertionComment>
                                </wsp:OneOrMore>
                                <wsp:All wsp:Usage="Required">
                                    <L7p:Delay>
                                    <L7p:DelayMilliSec stringValue="${delay}"/>
                                    </L7p:Delay>
                                    <L7p:HttpRoutingAssertion>
                                    <L7p:AssertionComment assertionComment="included">
                                    <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="LEFT.COMMENT"/>
                                    <L7p:value stringValue="route in loop till response or timeout"/>
                                    </L7p:entry>
                                    </L7p:Properties>
                                    </L7p:AssertionComment>
                                    <L7p:Enabled booleanValue="false"/>
                                    <L7p:MaxRetries intValue="0"/>
                                    <L7p:ProtectedServiceUrl stringValue="http://localhost:8080/LegacyImported/${serviceName}${stub}"/>
                                    <L7p:ProxyPassword stringValueNull="null"/>
                                    <L7p:ProxyUsername stringValueNull="null"/>
                                    <L7p:RequestHeaderRules httpPassthroughRuleSet="included">
                                    <L7p:Rules httpPassthroughRules="included">
                                    <L7p:item httpPassthroughRule="included">
                                    <L7p:Name stringValue="Cookie"/>
                                    </L7p:item>
                                    <L7p:item httpPassthroughRule="included">
                                    <L7p:Name stringValue="SOAPAction"/>
                                    </L7p:item>
                                    </L7p:Rules>
                                    </L7p:RequestHeaderRules>
                                    <L7p:RequestMsgSrc stringValue="XMLRequest"/>
                                    <L7p:RequestParamRules httpPassthroughRuleSet="included">
                                    <L7p:ForwardAll booleanValue="true"/>
                                    <L7p:Rules httpPassthroughRules="included"/>
                                    </L7p:RequestParamRules>
                                    <L7p:ResponseHeaderRules httpPassthroughRuleSet="included">
                                    <L7p:Rules httpPassthroughRules="included">
                                    <L7p:item httpPassthroughRule="included">
                                    <L7p:Name stringValue="Set-Cookie"/>
                                    </L7p:item>
                                    </L7p:Rules>
                                    </L7p:ResponseHeaderRules>
                                    <L7p:ResponseMsgDest stringValue="finalResponse"/>
                                    <L7p:SamlAssertionVersion intValue="2"/>
                                    </L7p:HttpRoutingAssertion>
                                    <L7p:Include>
                                    <L7p:PolicyGuid stringValue="317ddcb2-f89d-4db4-ae1a-0e29ddef31c8"/>
                                    </L7p:Include>
                                    <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="JHtvdXRwdXR9"/>
                                    <L7p:ContentType stringValue="text/xml; charset=utf-8"/>
                                    <L7p:DataType variableDataType="message"/>
                                    <L7p:VariableToSet stringValue="finalResponse"/>
                                    </L7p:SetVariable>
                                    <L7p:AuditDetailAssertion>
                                    <L7p:Detail stringValueReference="inline"><![CDATA[inside loop ${i.current} 
finalResponse=: ${finalResponse.mainpart}]]></L7p:Detail>
                                    </L7p:AuditDetailAssertion>
                                    <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue=" // wait for eta/deivezer and call to service again"/>
                                    </L7p:entry>
                                    </L7p:Properties>
                                    </L7p:assertionComment>
                                </wsp:All>
                                <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue=" // Keep trying until 1. response 2. timeout"/>
                                    </L7p:entry>
                                    </L7p:Properties>
                                </L7p:assertionComment>
                            </L7p:ForEachLoop>
                            <wsp:OneOrMore wsp:Usage="Required">
                                <L7p:ComparisonAssertion>
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Expression1 stringValue="${responseReceived}"/>
                                    <L7p:MultivaluedComparison multivaluedComparison="FAIL"/>
                                    <L7p:Operator operatorNull="null"/>
                                    <L7p:Predicates predicates="included">
                                    <L7p:item dataType="included">
                                    <L7p:Type variableDataType="string"/>
                                    </L7p:item>
                                    <L7p:item binary="included">
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:RightValue stringValue="true"/>
                                    </L7p:item>
                                    </L7p:Predicates>
                                </L7p:ComparisonAssertion>
                                <wsp:All wsp:Usage="Required">
                                    <L7p:AuditDetailAssertion>
                                    <L7p:CustomLoggerSuffix stringValue="LogToSplunk"/>
                                    <L7p:Detail stringValue="receiveLoop attempt=timeout took=${request.elapsedTime}"/>
                                    <L7p:LoggingOnly booleanValue="true"/>
                                    </L7p:AuditDetailAssertion>
                                    <L7p:HardcodedResponse>
                                    <L7p:Base64ResponseBody stringValue="PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiID8+IAogPElGX1JFUExZPgogCTxTRVJWSUNFX05BTUU+JHtTZXJ2aWNlTmFtZX08L1NFUlZJQ0VfTkFNRT4gCiAJPFJFUVVFU1RfU1RBVFVTPgogIAkJPFNUQVRVUz5FUlJPUjwvU1RBVFVTPiAKICAJCTxTVEFUVVNfQ09ERT4yPC9TVEFUVVNfQ09ERT4gCiAgCQk8U1RBVFVTX01FU1NBR0U+U1JCOlJlY2VpdmUgVGltZW91dCBhZnRlciAke2NvbnN1bWVyVGltZW91dH06JHtyZXF1ZXN0LmVsYXBzZWRUaW1lfSBkZWxheT0ke2RlbGF5fSBpdGVyYXRvcnM9JHtpdGVyYXRvcnN9IGlsPSR7aXRlcmF0b3JzLmxlbmd0aH08L1NUQVRVU19NRVNTQUdFPiAKICAJPC9SRVFVRVNUX1NUQVRVUz4KICAJPFJFUVVFU1RfSUQ+JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLnJlcXVlc3RJRH08L1JFUVVFU1RfSUQ+IAogIDwvSUZfUkVQTFk+"/>
                                    </L7p:HardcodedResponse>
                                </wsp:All>
                            </wsp:OneOrMore>
                            <L7p:assertionComment>
                                <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// if there is an ETA come in here"/>
                                    </L7p:entry>
                                </L7p:Properties>
                            </L7p:assertionComment>
                        </wsp:All>
                        <L7p:assertionComment>
                            <L7p:Properties mapValue="included">
                                <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="  // Handle finalResponse"/>
                                </L7p:entry>
                            </L7p:Properties>
                        </L7p:assertionComment>
                    </wsp:OneOrMore>
                </wsp:All>
            </wsp:Policy>
        </IncludedPolicyReference>
        <IncludedPolicyReference
            RefType="com.l7tech.console.policy.exporter.IncludedPolicyReference"
            guid="0a5e426c-983e-4787-a630-d12ed1632905" included="true"
            name="Legacy - Last details" soap="false" type="INCLUDE_FRAGMENT">
            <exp:Export Version="3.0"
                xmlns:L7p="http://www.layer7tech.com/ws/policy"
                xmlns:exp="http://www.layer7tech.com/ws/policy/export" xmlns:wsp="http://schemas.xmlsoap.org/ws/2002/12/policy">
                <exp:References/>
                <wsp:Policy
                    xmlns:L7p="http://www.layer7tech.com/ws/policy" xmlns:wsp="http://schemas.xmlsoap.org/ws/2002/12/policy">
                    <wsp:All wsp:Usage="Required">
                        <L7p:CommentAssertion>
                            <L7p:Comment stringValue="*************************************************************************"/>
                        </L7p:CommentAssertion>
                        <L7p:CommentAssertion>
                            <L7p:Comment stringValue="**Legacy  Last Details"/>
                        </L7p:CommentAssertion>
                        <L7p:CommentAssertion>
                            <L7p:Comment stringValue="** "/>
                        </L7p:CommentAssertion>
                        <L7p:CommentAssertion>
                            <L7p:Comment stringValue="** Escape request/response used by regular expession"/>
                        </L7p:CommentAssertion>
                        <L7p:CommentAssertion>
                            <L7p:Comment stringValue="** "/>
                        </L7p:CommentAssertion>
                        <L7p:CommentAssertion>
                            <L7p:Comment stringValue="*************************************************************************"/>
                        </L7p:CommentAssertion>
                        <L7p:AuditDetailAssertion>
                            <L7p:Detail stringValue="Policy Fragment: Legacy - Last Details"/>
                        </L7p:AuditDetailAssertion>
                        <wsp:All wsp:Usage="Required">
                            <L7p:SetVariable>
                                <L7p:Base64Expression stringValue=""/>
                                <L7p:VariableToSet stringValue="audits"/>
                            </L7p:SetVariable>
                            <L7p:ForEachLoop L7p:Usage="Required"
                                loopVariable="audit.details" variablePrefix="ad">
                                <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="JHthZC5jdXJyZW50LnRpbWV9"/>
                                    <L7p:DataType variableDataType="dateTime"/>
                                    <L7p:DateOffsetExpression stringValue=""/>
                                    <L7p:VariableToSet stringValue="ad.current.time"/>
                                </L7p:SetVariable>
                                <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="JHthdWRpdHN9DQoke2FkLmN1cnJlbnQudGltZX0gLSAke2FkLmN1cnJlbnQuZnVsbHRleHR9"/>
                                    <L7p:VariableToSet stringValue="audits"/>
                                </L7p:SetVariable>
                            </L7p:ForEachLoop>
                            <L7p:SetVariable>
                                <L7p:Base64Expression stringValue="PElGX1JFUExZPg0KPFNFUlZJQ0VfTkFNRT4ke3NlcnZpY2VOYW1lfTwvU0VSVklDRV9OQU1FPg0KPFJFUVVFU1RfU1RBVFVTPg0KPFNUQVRVUz5FUlJPUjwvU1RBVFVTPg0KPFNUQVRVU19DT0RFPjc8L1NUQVRVU19DT0RFPg0KPFNUQVRVU19NRVNTQUdFPkVTQjoke2F1ZGl0c30NCiR7YXNzZXJ0aW9uLm51bWJlcnN0cn0gDQo8L1NUQVRVU19NRVNTQUdFPg0KPC9SRVFVRVNUX1NUQVRVUz4NCjwvSUZfUkVQTFk+"/>
                                <L7p:VariableToSet stringValue="jdbcQuery.return_value"/>
                            </L7p:SetVariable>
                            <L7p:SetVariable>
                                <L7p:Base64Expression stringValue="JHtqZGJjUXVlcnkucmV0dXJuX3ZhbHVlfQ=="/>
                                <L7p:ContentType stringValue="text/xml; charset=utf-8"/>
                                <L7p:DataType variableDataType="message"/>
                                <L7p:VariableToSet stringValue="HTTPoutput"/>
                            </L7p:SetVariable>
                        </wsp:All>
                    </wsp:All>
                </wsp:Policy>
            </exp:Export>
        </IncludedPolicyReference>
        <RemoteCacheReference RefType="com.l7tech.external.assertions.remotecacheassertion.RemoteCacheReference">
            <OID>0</OID>
            <Timeout>0</Timeout>
            <Properties/>
        </RemoteCacheReference>
        <JdbcConnectionReference RefType="com.l7tech.console.policy.exporter.JdbcConnectionReference">
            <ConnectionName>${config.connection}</ConnectionName>
            <AdditionalProperties/>
        </JdbcConnectionReference>
    </exp:References>
    <wsp:Policy xmlns:L7p="http://www.layer7tech.com/ws/policy" xmlns:wsp="http://schemas.xmlsoap.org/ws/2002/12/policy">
        <wsp:All wsp:Usage="Required">
            <L7p:CommentAssertion>
                <L7p:Comment stringValue="**************************************************************************"/>
            </L7p:CommentAssertion>
            <L7p:CommentAssertion>
                <L7p:Comment stringValue="** Legacy IF Service as HTTP Request"/>
            </L7p:CommentAssertion>
            <L7p:CommentAssertion>
                <L7p:Comment stringValue="** "/>
            </L7p:CommentAssertion>
            <L7p:CommentAssertion>
                <L7p:Comment stringValue="** HTTP service to invoke legacy services"/>
            </L7p:CommentAssertion>
            <L7p:CommentAssertion>
                <L7p:Comment stringValue="** "/>
            </L7p:CommentAssertion>
            <L7p:CommentAssertion>
                <L7p:Comment stringValue="** v0.0.0 - 20130214 - Daniel Haviv"/>
            </L7p:CommentAssertion>
            <L7p:CommentAssertion>
                <L7p:Comment stringValue="*************************************************************************"/>
            </L7p:CommentAssertion>
            <L7p:AuditDetailAssertion>
                <L7p:Detail stringValue="Inside LegacyIFService"/>
            </L7p:AuditDetailAssertion>
            <L7p:AuditAssertion/>
            <L7p:AuditDetailAssertion>
                <L7p:Detail stringValueReference="inline"><![CDATA[Parameters:
request.http.method=${request.http.method} 
action: "${request.http.parameter.action}"
timeout: "${request.http.parameter.timeout}"
xmlRequest: "${request.http.parameter.xmlRequest}"
serviceName: "${request.http.parameter.serviceName}"
reqOrigin: "${request.http.parameter.reqOrigin}"
reqOriginApp: "${request.http.parameter.reqOriginApp}"
reqOriginator: "${request.http.parameter.reqOriginator}"]]></L7p:Detail>
            </L7p:AuditDetailAssertion>
            <L7p:RateLimit>
                <L7p:CounterName stringValue="${request.http.parameter.action}"/>
                <L7p:LogOnly booleanValue="true"/>
                <L7p:MaxConcurrency stringValue="1000000"/>
                <L7p:MaxRequestsPerSecond stringValue="100000"/>
                <L7p:SplitConcurrencyLimitAcrossNodes booleanValue="false"/>
                <L7p:SplitRateLimitAcrossNodes booleanValue="false"/>
            </L7p:RateLimit>
            <L7p:RateLimitQuery>
                <L7p:CounterName stringValue="${request.http.parameter.action}"/>
                <L7p:VariablePrefix stringValue="typeCounter"/>
            </L7p:RateLimitQuery>
            <L7p:AuditDetailAssertion>
                <L7p:CustomLoggerSuffix stringValue="LogToSplunk"/>
                <L7p:Detail stringValue="typeConcurrency type=${request.http.parameter.action} value=${typeCounter.counter.concurrency}"/>
                <L7p:LoggingOnly booleanValue="true"/>
            </L7p:AuditDetailAssertion>
            <wsp:OneOrMore wsp:Usage="Required">
                <wsp:All wsp:Usage="Required">
                    <L7p:ComparisonAssertion>
                        <L7p:CaseSensitive booleanValue="false"/>
                        <L7p:Expression1 stringValue="${request.http.parameters.action}"/>
                        <L7p:ExpressionIsVariable booleanValue="false"/>
                        <L7p:MultivaluedComparison multivaluedComparison="FIRST"/>
                        <L7p:Operator operatorNull="null"/>
                        <L7p:Predicates predicates="included">
                            <L7p:item dataType="included">
                                <L7p:Type variableDataType="string"/>
                            </L7p:item>
                            <L7p:item binary="included">
                                <L7p:CaseSensitive booleanValue="false"/>
                                <L7p:RightValue stringValue="SendReceive"/>
                            </L7p:item>
                        </L7p:Predicates>
                    </L7p:ComparisonAssertion>
                    <L7p:AuditDetailAssertion>
                        <L7p:Detail stringValue="Inside SR"/>
                    </L7p:AuditDetailAssertion>
                    <L7p:SetVariable>
                        <L7p:Base64Expression stringValue="U2VuZFJlY2VpdmU="/>
                        <L7p:VariableToSet stringValue="LegacyTraceAction"/>
                    </L7p:SetVariable>
                    <wsp:OneOrMore wsp:Usage="Required">
                        <wsp:All wsp:Usage="Required">
                            <L7p:ComparisonAssertion>
                                <L7p:CaseSensitive booleanValue="false"/>
                                <L7p:Expression1 stringValue="${request.http.parameter.serviceName}"/>
                                <L7p:ExpressionIsVariable booleanValue="false"/>
                                <L7p:Operator operatorNull="null"/>
                                <L7p:Predicates predicates="included">
                                    <L7p:item dataType="included">
                                    <L7p:Type variableDataType="string"/>
                                    </L7p:item>
                                    <L7p:item binary="included">
                                    <L7p:Negated booleanValue="true"/>
                                    <L7p:Operator operator="EMPTY"/>
                                    <L7p:RightValue stringValue=""/>
                                    </L7p:item>
                                </L7p:Predicates>
                            </L7p:ComparisonAssertion>
                            <wsp:OneOrMore wsp:Usage="Required">
                                <wsp:All wsp:Usage="Required">
                                    <L7p:ComparisonAssertion>
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Expression1 stringValue="${request.http.parameter.stub}"/>
                                    <L7p:ExpressionIsVariable booleanValue="false"/>
                                    <L7p:Operator operatorNull="null"/>
                                    <L7p:Predicates predicates="included">
                                    <L7p:item dataType="included">
                                    <L7p:Type variableDataType="boolean"/>
                                    </L7p:item>
                                    <L7p:item binary="included">
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:RightValue stringValue="true"/>
                                    </L7p:item>
                                    </L7p:Predicates>
                                    </L7p:ComparisonAssertion>
                                    <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="X1NUVUI="/>
                                    <L7p:VariableToSet stringValue="stub"/>
                                    </L7p:SetVariable>
                                    <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue=" // Handle stub=true"/>
                                    </L7p:entry>
                                    </L7p:Properties>
                                    </L7p:assertionComment>
                                </wsp:All>
                                <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue=""/>
                                    <L7p:VariableToSet stringValue="stub"/>
                                </L7p:SetVariable>
                                <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue=" // If a stub, route to the stub service"/>
                                    </L7p:entry>
                                    </L7p:Properties>
                                </L7p:assertionComment>
                            </wsp:OneOrMore>
                            <L7p:SetVariable>
                                <L7p:Base64Expression stringValue="JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLnhtbFJlcXVlc3R9"/>
                                <L7p:VariableToSet stringValue="responseOut"/>
                            </L7p:SetVariable>
                            <L7p:Include>
                                <L7p:PolicyGuid stringValue="9bb870ad-0b68-47c6-a7ba-4c1eff19a531"/>
                            </L7p:Include>
                            <wsp:OneOrMore wsp:Usage="Required">
                                <wsp:All wsp:Usage="Required">
                                    <L7p:ComparisonAssertion>
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Expression1 stringValue="${request.http.parameter.timeout}"/>
                                    <L7p:ExpressionIsVariable booleanValue="false"/>
                                    <L7p:Operator operatorNull="null"/>
                                    <L7p:Predicates predicates="included">
                                    <L7p:item dataType="included">
                                    <L7p:Type variableDataType="string"/>
                                    </L7p:item>
                                    <L7p:item binary="included">
                                    <L7p:Negated booleanValue="true"/>
                                    <L7p:Operator operator="EMPTY"/>
                                    <L7p:RightValue stringValue=""/>
                                    </L7p:item>
                                    <L7p:item regex="included">
                                    <L7p:Pattern stringValue="^\d+$"/>
                                    </L7p:item>
                                    </L7p:Predicates>
                                    </L7p:ComparisonAssertion>
                                    <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="PGNvbnN1bWVyVGltZW91dD4ke3JlcXVlc3QuaHR0cC5wYXJhbWV0ZXIudGltZW91dH08L2NvbnN1bWVyVGltZW91dD4="/>
                                    <L7p:VariableToSet stringValue="timeoutElement"/>
                                    </L7p:SetVariable>
                                </wsp:All>
                                <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue=""/>
                                    <L7p:VariableToSet stringValue="timeoutElement"/>
                                </L7p:SetVariable>
                            </wsp:OneOrMore>
                            <L7p:SetVariable>
                                <L7p:AssertionComment assertionComment="included">
                                    <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="  // Set the soap request"/>
                                    </L7p:entry>
                                    </L7p:Properties>
                                </L7p:AssertionComment>
                                <L7p:Base64Expression stringValue="PHNvYXBlbnY6RW52ZWxvcGUgeG1sbnM6c29hcGVudj0iaHR0cDovL3NjaGVtYXMueG1sc29hcC5vcmcvc29hcC9lbnZlbG9wZS8iIHhtbG5zOnNlcj0iaHR0cDovL3d3dy5vcmFuZ2UuY28uaWwvc2VydmljZXMiPg0KICAgPHNvYXBlbnY6SGVhZGVyLz4NCiAgIDxzb2FwZW52OkJvZHk+DQogICAgICA8c2VyOkludm9rZT4NCiAgICAgICAgIDxzZXJ2aWNlTmFtZT4ke3JlcXVlc3QuaHR0cC5wYXJhbWV0ZXIuc2VydmljZU5hbWV9PC9zZXJ2aWNlTmFtZT4NCiAgICAgICAgIDwhLS1Zb3UgaGF2ZSBhIENIT0lDRSBvZiB0aGUgbmV4dCAyIGl0ZW1zIGF0IHRoaXMgbGV2ZWwtLT4NCiAgICAgICAgIDxpbnZvY2F0aW9uUGFyYW1ldGVycz4NCiAgICAgICAgICAgIDwhLS1PcHRpb25hbDotLT4NCiAgICAgICAgICAgIDxhc3luYz5mYWxzZTwvYXN5bmM+DQoJICAgIDxmb3JjZVN5bmM+JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLmZvcmNlU3luY308L2ZvcmNlU3luYz4NCiAgICAgICAgICAgIDxhcmd1bWVudHM+DQogICAgICAgICAgICAgICA8aW5wdXQ+JHtyZXNwb25zZU91dH08L2lucHV0Pg0KICAgICAgICAgICAgPC9hcmd1bWVudHM+DQogICAgICAgICAgICAke3RpbWVvdXRFbGVtZW50fQ0KICAgICAgICAgICAgPHJlcU9yaWdpbj4ke3JlcXVlc3QuaHR0cC5wYXJhbWV0ZXIucmVxT3JpZ2lufTwvcmVxT3JpZ2luPg0KICAgICAgICAgICAgPHJlcU9yaWdpbkFwcD4ke3JlcXVlc3QuaHR0cC5wYXJhbWV0ZXIucmVxT3JpZ2luQXBwfTwvcmVxT3JpZ2luQXBwPg0KICAgICAgICAgICAgPHJlcU9yaWdpbmF0b3I+JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLnJlcU9yaWdpbmF0b3J9PC9yZXFPcmlnaW5hdG9yPg0KICAgICAgICAgPC9pbnZvY2F0aW9uUGFyYW1ldGVycz4NCiAgICAgIDwvc2VyOkludm9rZT4NCiAgIDwvc29hcGVudjpCb2R5Pg0KPC9zb2FwZW52OkVudmVsb3BlPg=="/>
                                <L7p:ContentType stringValue="text/xml; charset=utf-8"/>
                                <L7p:DataType variableDataType="message"/>
                                <L7p:VariableToSet stringValue="XMLRequest"/>
                            </L7p:SetVariable>
                            <L7p:CommentAssertion>
                                <L7p:Comment stringValue="Route the request wrapped in a SOAP message to the legacy service"/>
                            </L7p:CommentAssertion>
                            <wsp:OneOrMore wsp:Usage="Required">
                                <wsp:All wsp:Usage="Required">
                                    <L7p:ComparisonAssertion>
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Expression1 stringValue="${request.http.parameter.timeout}"/>
                                    <L7p:Operator operatorNull="null"/>
                                    <L7p:Predicates predicates="included">
                                    <L7p:item stringLength="included">
                                    <L7p:Max intValue="-1"/>
                                    <L7p:Min intValue="1"/>
                                    </L7p:item>
                                    </L7p:Predicates>
                                    </L7p:ComparisonAssertion>
                                    <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLnRpbWVvdXR9MDAw"/>
                                    <L7p:DataType variableDataType="int"/>
                                    <L7p:VariableToSet stringValue="consumerTimeout"/>
                                    </L7p:SetVariable>
                                    <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// Check if a timeout parameter is passed by the request."/>
                                    </L7p:entry>
                                    </L7p:Properties>
                                    </L7p:assertionComment>
                                </wsp:All>
                                <L7p:SetVariable>
                                    <L7p:AssertionComment assertionComment="included">
                                    <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// if the above is not set then use default setting from system"/>
                                    </L7p:entry>
                                    </L7p:Properties>
                                    </L7p:AssertionComment>
                                    <L7p:Base64Expression stringValue="JHtnYXRld2F5LnBhcnRuZXIuY29uZmlndXJhdGlvbi5jb25zdW1lclRpbWVvdXR9MDAw"/>
                                    <L7p:DataType variableDataType="int"/>
                                    <L7p:VariableToSet stringValue="consumerTimeout"/>
                                </L7p:SetVariable>
                                <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// checks what consumerTimeout to use for the HTTP assertion"/>
                                    </L7p:entry>
                                    </L7p:Properties>
                                </L7p:assertionComment>
                            </wsp:OneOrMore>
                            <L7p:AuditDetailAssertion>
                                <L7p:Detail stringValue="CONSUMERTIMEOUT=${consumerTimeout}"/>
                            </L7p:AuditDetailAssertion>
                            <L7p:SetVariable>
                                <L7p:Base64Expression stringValue="JHtyZXF1ZXN0LmVsYXBzZWRUaW1lfQ=="/>
                                <L7p:DataType variableDataType="int"/>
                                <L7p:VariableToSet stringValue="before"/>
                            </L7p:SetVariable>
                            <wsp:OneOrMore wsp:Usage="Required">
                                <L7p:HttpRoutingAssertion>
                                    <L7p:AssertionComment assertionComment="included">
                                    <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// TEST!!!"/>
                                    </L7p:entry>
                                    <L7p:entry>
                                    <L7p:key stringValue="LEFT.COMMENT"/>
                                    <L7p:value stringValue="// TEST!!!"/>
                                    </L7p:entry>
                                    </L7p:Properties>
                                    </L7p:AssertionComment>
                                    <L7p:Enabled booleanValue="false"/>
                                    <L7p:FailOnErrorStatus booleanValue="false"/>
                                    <L7p:MaxRetries intValue="1"/>
                                    <L7p:ProtectedServiceUrl stringValue="http://rrrr.com"/>
                                    <L7p:ProxyPassword stringValueNull="null"/>
                                    <L7p:ProxyUsername stringValueNull="null"/>
                                    <L7p:RequestHeaderRules httpPassthroughRuleSet="included">
                                    <L7p:Rules httpPassthroughRules="included">
                                    <L7p:item httpPassthroughRule="included">
                                    <L7p:Name stringValue="Cookie"/>
                                    </L7p:item>
                                    <L7p:item httpPassthroughRule="included">
                                    <L7p:Name stringValue="SOAPAction"/>
                                    </L7p:item>
                                    </L7p:Rules>
                                    </L7p:RequestHeaderRules>
                                    <L7p:RequestMsgSrc stringValue="XMLRequest"/>
                                    <L7p:RequestParamRules httpPassthroughRuleSet="included">
                                    <L7p:ForwardAll booleanValue="true"/>
                                    <L7p:Rules httpPassthroughRules="included"/>
                                    </L7p:RequestParamRules>
                                    <L7p:ResponseHeaderRules httpPassthroughRuleSet="included">
                                    <L7p:Rules httpPassthroughRules="included">
                                    <L7p:item httpPassthroughRule="included">
                                    <L7p:Name stringValue="Set-Cookie"/>
                                    </L7p:item>
                                    </L7p:Rules>
                                    </L7p:ResponseHeaderRules>
                                    <L7p:SamlAssertionVersion intValue="2"/>
                                    <L7p:Timeout stringValue="200"/>
                                </L7p:HttpRoutingAssertion>
                                <L7p:HttpRoutingAssertion>
                                    <L7p:AssertionComment assertionComment="included">
                                    <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue=" // using consumerTimeout here"/>
                                    </L7p:entry>
                                    </L7p:Properties>
                                    </L7p:AssertionComment>
                                    <L7p:ProtectedServiceUrl stringValue="http://127.0.0.1:18080/LegacyImported/${request.http.parameter.serviceName}${stub}?LegacyTraceAction=${LegacyTraceAction}"/>
                                    <L7p:ProxyPassword stringValueNull="null"/>
                                    <L7p:ProxyUsername stringValueNull="null"/>
                                    <L7p:RequestHeaderRules httpPassthroughRuleSet="included">
                                    <L7p:Rules httpPassthroughRules="included">
                                    <L7p:item httpPassthroughRule="included">
                                    <L7p:Name stringValue="Cookie"/>
                                    </L7p:item>
                                    <L7p:item httpPassthroughRule="included">
                                    <L7p:Name stringValue="SOAPAction"/>
                                    </L7p:item>
                                    </L7p:Rules>
                                    </L7p:RequestHeaderRules>
                                    <L7p:RequestMsgSrc stringValue="XMLRequest"/>
                                    <L7p:RequestParamRules httpPassthroughRuleSet="included">
                                    <L7p:ForwardAll booleanValue="true"/>
                                    <L7p:Rules httpPassthroughRules="included"/>
                                    </L7p:RequestParamRules>
                                    <L7p:ResponseHeaderRules httpPassthroughRuleSet="included">
                                    <L7p:Rules httpPassthroughRules="included">
                                    <L7p:item httpPassthroughRule="included">
                                    <L7p:Name stringValue="Set-Cookie"/>
                                    </L7p:item>
                                    </L7p:Rules>
                                    </L7p:ResponseHeaderRules>
                                    <L7p:ResponseMsgDest stringValue="responseMsg"/>
                                    <L7p:SamlAssertionVersion intValue="2"/>
                                    <L7p:Timeout stringValue="${consumerTimeout}"/>
                                </L7p:HttpRoutingAssertion>
                                <wsp:All L7p:Enabled="false" wsp:Usage="Required">
                                    <L7p:Delay>
                                    <L7p:DelayMilliSec stringValue="50"/>
                                    </L7p:Delay>
                                    <L7p:SetVariable>
                                    <L7p:AssertionComment assertionComment="included">
                                    <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="  // Set the soap request"/>
                                    </L7p:entry>
                                    </L7p:Properties>
                                    </L7p:AssertionComment>
                                    <L7p:Base64Expression stringValue="PHNvYXBlbnY6RW52ZWxvcGUgeG1sbnM6c29hcGVudj0iaHR0cDovL3NjaGVtYXMueG1sc29hcC5vcmcvc29hcC9lbnZlbG9wZS8iIHhtbG5zOnNlcj0iaHR0cDovL3d3dy5vcmFuZ2UuY28uaWwvc2VydmljZXMiPg0KICAgPHNvYXBlbnY6SGVhZGVyLz4NCiAgIDxzb2FwZW52OkJvZHk+DQogICAgICA8c2VyOkludm9rZT4NCiAgICAgICAgIDxzZXJ2aWNlTmFtZT4ke3JlcXVlc3QuaHR0cC5wYXJhbWV0ZXIuc2VydmljZU5hbWV9PC9zZXJ2aWNlTmFtZT4NCiAgICAgICAgIDwhLS1Zb3UgaGF2ZSBhIENIT0lDRSBvZiB0aGUgbmV4dCAyIGl0ZW1zIGF0IHRoaXMgbGV2ZWwtLT4NCiAgICAgICAgIDxpbnZvY2F0aW9uUGFyYW1ldGVycz4NCiAgICAgICAgICAgIDwhLS1PcHRpb25hbDotLT4NCiAgICAgICAgICAgIDxhc3luYz5mYWxzZTwvYXN5bmM+DQoJICAgIDxmb3JjZVN5bmM+JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLmZvcmNlU3luY308L2ZvcmNlU3luYz4NCiAgICAgICAgICAgIDxhcmd1bWVudHM+DQogICAgICAgICAgICAgICA8aW5wdXQ+LS0tLS0tLS0tLS0tLS0tLS08L2lucHV0Pg0KICAgICAgICAgICAgPC9hcmd1bWVudHM+DQogICAgICAgICAgICAke3RpbWVvdXRFbGVtZW50fQ0KICAgICAgICAgICAgPHJlcU9yaWdpbj4ke3JlcXVlc3QuaHR0cC5wYXJhbWV0ZXIucmVxT3JpZ2lufTwvcmVxT3JpZ2luPg0KICAgICAgICAgICAgPHJlcU9yaWdpbkFwcD4ke3JlcXVlc3QuaHR0cC5wYXJhbWV0ZXIucmVxT3JpZ2luQXBwfTwvcmVxT3JpZ2luQXBwPg0KICAgICAgICAgICAgPHJlcU9yaWdpbmF0b3I+JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLnJlcU9yaWdpbmF0b3J9PC9yZXFPcmlnaW5hdG9yPg0KICAgICAgICAgPC9pbnZvY2F0aW9uUGFyYW1ldGVycz4NCiAgICAgIDwvc2VyOkludm9rZT4NCiAgIDwvc29hcGVudjpCb2R5Pg0KPC9zb2FwZW52OkVudmVsb3BlPg=="/>
                                    <L7p:ContentType stringValue="text/xml; charset=utf-8"/>
                                    <L7p:DataType variableDataType="message"/>
                                    <L7p:VariableToSet stringValue="responseMsg"/>
                                    </L7p:SetVariable>
                                    <L7p:HardcodedResponse>
                                    <L7p:Base64ResponseBody stringValue="PElGX1JFUExZPgo8U0VSVklDRV9OQU1FPlRFU1RfSUZfVEVTVDwvU0VSVklDRV9OQU1FPgo8UkVRVUVTVF9TVEFUVVM+CjxTVEFUVVM+U1VDQ0VTUzwvU1RBVFVTPgo8U1RBVFVTX0NPREU+MDwvU1RBVFVTX0NPREU+CjxTVEFUVVNfTUVTU0FHRS8+CjxERUJVR19JTkZPLz4KPC9SRVFVRVNUX1NUQVRVUz4KPFJFUVVFU1RfUkVTVUxUPgpBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBPgo8L1JFUVVFU1RfUkVTVUxUPgo8L0lGX1JFUExZPg=="/>
                                    <L7p:EarlyResponse booleanValue="true"/>
                                    </L7p:HardcodedResponse>
                                    <L7p:FalseAssertion/>
                                    <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue=" // test !!! ///"/>
                                    </L7p:entry>
                                    <L7p:entry>
                                    <L7p:key stringValue="LEFT.COMMENT"/>
                                    <L7p:value stringValue=" // test !!! //"/>
                                    </L7p:entry>
                                    </L7p:Properties>
                                    </L7p:assertionComment>
                                </wsp:All>
                                <wsp:All wsp:Usage="Required">
                                    <L7p:AuditDetailAssertion>
                                    <L7p:Detail stringValue="SendReceive routing failure: httpRouting.reasonCode = ${httpRouting.reasonCode}"/>
                                    </L7p:AuditDetailAssertion>
                                    <L7p:ComparisonAssertion>
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Expression1 stringValue="${httpRouting.reasonCode}"/>
                                    <L7p:ExpressionIsVariable booleanValue="false"/>
                                    <L7p:Operator operatorNull="null"/>
                                    <L7p:Predicates predicates="included">
                                    <L7p:item dataType="included">
                                    <L7p:Type variableDataType="int"/>
                                    </L7p:item>
                                    <L7p:item binary="included">
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:RightValue stringValue="-3"/>
                                    </L7p:item>
                                    </L7p:Predicates>
                                    </L7p:ComparisonAssertion>
                                    <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiID8+IA0KIDxJRl9SRVBMWT4NCiAJPFNFUlZJQ0VfTkFNRT4ke3JlcXVlc3QuaHR0cC5wYXJhbWV0ZXIuc2VydmljZU5hbWV9PC9TRVJWSUNFX05BTUU+IA0KIAk8UkVRVUVTVF9TVEFUVVM+DQogIAkJPFNUQVRVUz5FUlJPUjwvU1RBVFVTPiANCiAgCQk8U1RBVFVTX0NPREU+MjwvU1RBVFVTX0NPREU+IA0KICAJCTxTVEFUVVNfTUVTU0FHRT5TUkI6Q29ubmVjdCBUaW1lb3V0IG9uIFNlbmRSZWNpZXZlPC9TVEFUVVNfTUVTU0FHRT4gDQogIAk8L1JFUVVFU1RfU1RBVFVTPg0KICA8L0lGX1JFUExZPg=="/>
                                    <L7p:ContentType stringValue="text/xml; charset=utf-8"/>
                                    <L7p:DataType variableDataType="message"/>
                                    <L7p:VariableToSet stringValue="responseMsg"/>
                                    </L7p:SetVariable>
                                    <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue=" // Handle Connect Time Out response from Receive - Return TimeOut"/>
                                    </L7p:entry>
                                    </L7p:Properties>
                                    </L7p:assertionComment>
                                </wsp:All>
                                <wsp:All wsp:Usage="Required">
                                    <L7p:ComparisonAssertion>
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Expression1 stringValue="${httpRouting.reasonCode}"/>
                                    <L7p:ExpressionIsVariable booleanValue="false"/>
                                    <L7p:Operator operatorNull="null"/>
                                    <L7p:Predicates predicates="included">
                                    <L7p:item dataType="included">
                                    <L7p:Type variableDataType="int"/>
                                    </L7p:item>
                                    <L7p:item binary="included">
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:RightValue stringValue="-4"/>
                                    </L7p:item>
                                    </L7p:Predicates>
                                    </L7p:ComparisonAssertion>
                                    <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiID8+IA0KIDxJRl9SRVBMWT4NCiAJPFNFUlZJQ0VfTkFNRT4ke3JlcXVlc3QuaHR0cC5wYXJhbWV0ZXIuc2VydmljZU5hbWV9PC9TRVJWSUNFX05BTUU+IA0KIAk8UkVRVUVTVF9TVEFUVVM+DQogIAkJPFNUQVRVUz5FUlJPUjwvU1RBVFVTPiANCiAgCQk8U1RBVFVTX0NPREU+MjwvU1RBVFVTX0NPREU+IA0KICAJCTxTVEFUVVNfTUVTU0FHRT5TUkI6UmVhZCBUaW1lb3V0IG9uIFNlbmRSZWNlaXZlPC9TVEFUVVNfTUVTU0FHRT4gDQogIAk8L1JFUVVFU1RfU1RBVFVTPg0KICA8L0lGX1JFUExZPg=="/>
                                    <L7p:ContentType stringValue="text/xml; charset=utf-8"/>
                                    <L7p:DataType variableDataType="message"/>
                                    <L7p:VariableToSet stringValue="responseMsg"/>
                                    </L7p:SetVariable>
                                    <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue=" // Handle Read Time Out response from Receive - Return TimeOut"/>
                                    </L7p:entry>
                                    </L7p:Properties>
                                    </L7p:assertionComment>
                                </wsp:All>
                                <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// Invoke. Handle Timeout "/>
                                    </L7p:entry>
                                    </L7p:Properties>
                                </L7p:assertionComment>
                            </wsp:OneOrMore>
                            <L7p:CommentAssertion>
                                <L7p:Comment stringValue="Pull the response out of the response XML message"/>
                            </L7p:CommentAssertion>
                            <L7p:SetVariable>
                                <L7p:Base64Expression stringValue="JHtyZXF1ZXN0LmVsYXBzZWRUaW1lfQ=="/>
                                <L7p:DataType variableDataType="int"/>
                                <L7p:VariableToSet stringValue="after"/>
                            </L7p:SetVariable>
                            <L7p:AuditDetailAssertion>
                                <L7p:CustomLoggerSuffix stringValue="LogToSplunk"/>
                                <L7p:Detail stringValue="Latency serviceName=LegacyIFService before=${before} after=${after} reasonCode=${httpRouting.reasonCode}"/>
                                <L7p:LoggingOnly booleanValue="true"/>
                            </L7p:AuditDetailAssertion>
                            <L7p:CommentAssertion>
                                <L7p:Comment stringValue="** Checking if there is a response or not"/>
                            </L7p:CommentAssertion>
                            <L7p:CommentAssertion>
                                <L7p:Comment stringValue="** if there is not, then trigger the receive action"/>
                            </L7p:CommentAssertion>
                            <wsp:OneOrMore wsp:Usage="Required">
                                <wsp:All wsp:Usage="Required">
                                    <L7p:AuditDetailAssertion>
                                    <L7p:Detail stringValue="response: ${responseMsg.mainpart}"/>
                                    </L7p:AuditDetailAssertion>
                                    <L7p:ResponseXpathAssertion>
                                    <L7p:VariablePrefix stringValue=""/>
                                    <L7p:XmlMsgSrc stringValue="responseMsg"/>
                                    <L7p:XpathExpression xpathExpressionValue="included">
                                    <L7p:Expression stringValue="/s:Envelope/s:Body/ser:LegacyInvocationResponse/eta/text()"/>
                                    <L7p:Namespaces mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="ser"/>
                                    <L7p:value stringValue="http://www.orange.co.il/services"/>
                                    </L7p:entry>
                                    <L7p:entry>
                                    <L7p:key stringValue="s"/>
                                    <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                                    </L7p:entry>
                                    </L7p:Namespaces>
                                    <L7p:XpathVersion xpathVersion="XPATH_1_0"/>
                                    </L7p:XpathExpression>
                                    </L7p:ResponseXpathAssertion>
                                    <L7p:AuditDetailAssertion>
                                    <L7p:Detail stringValue="eta found at ${responseXpath.result}"/>
                                    </L7p:AuditDetailAssertion>
                                    <L7p:ResponseXpathAssertion>
                                    <L7p:VariablePrefix stringValue=""/>
                                    <L7p:XmlMsgSrc stringValue="responseMsg"/>
                                    <L7p:XpathExpression xpathExpressionValue="included">
                                    <L7p:Expression stringValue="/s:Envelope/s:Body/ser:LegacyInvocationResponse/requestId/text()"/>
                                    <L7p:Namespaces mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="s"/>
                                    <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                                    </L7p:entry>
                                    <L7p:entry>
                                    <L7p:key stringValue="ser"/>
                                    <L7p:value stringValue="http://www.orange.co.il/services"/>
                                    </L7p:entry>
                                    </L7p:Namespaces>
                                    <L7p:XpathVersion xpathVersion="XPATH_1_0"/>
                                    </L7p:XpathExpression>
                                    </L7p:ResponseXpathAssertion>
                                    <L7p:AuditDetailAssertion>
                                    <L7p:Detail stringValue="Request ID - ${responseXpath.result}"/>
                                    </L7p:AuditDetailAssertion>
                                    <wsp:OneOrMore wsp:Usage="Required">
                                    <wsp:All wsp:Usage="Required">
                                    <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="JHtyZXNwb25zZVhwYXRoLnJlc3VsdH0="/>
                                    <L7p:VariableToSet stringValue="partner.requestId"/>
                                    </L7p:SetVariable>
                                    <L7p:Include>
                                    <L7p:PolicyGuid stringValue="317ddcb2-f89d-4db4-ae1a-0e29ddef31c8"/>
                                    </L7p:Include>
                                    <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="JHtvdXRwdXR9"/>
                                    <L7p:ContentType stringValue="text/xml; charset=utf-8"/>
                                    <L7p:DataType variableDataType="message"/>
                                    <L7p:VariableToSet stringValue="responseMsg"/>
                                    </L7p:SetVariable>
                                    <L7p:AuditDetailAssertion>
                                    <L7p:Detail stringValue="Response from Recieve: ${output}"/>
                                    </L7p:AuditDetailAssertion>
                                    <L7p:Include>
                                    <L7p:AssertionComment assertionComment="included">
                                    <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// Return response or keep trying in Receive loop"/>
                                    </L7p:entry>
                                    </L7p:Properties>
                                    </L7p:AssertionComment>
                                    <L7p:PolicyGuid stringValue="f7faf570-d59b-454d-9a43-d963c760acb6"/>
                                    </L7p:Include>
                                    <L7p:HardcodedResponse>
                                    <L7p:Base64ResponseBody stringValue="JHtvdXRwdXR9"/>
                                    <L7p:EarlyResponse booleanValue="true"/>
                                    </L7p:HardcodedResponse>
                                    <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="  //  Try to get Response by request ID"/>
                                    </L7p:entry>
                                    </L7p:Properties>
                                    </L7p:assertionComment>
                                    </wsp:All>
                                    <wsp:All L7p:Enabled="false" wsp:Usage="Required">
                                    <wsp:OneOrMore wsp:Usage="Required">
                                    <wsp:All wsp:Usage="Required">
                                    <L7p:ComparisonAssertion>

                                    <L7p:AssertionComment assertionComment="included">

                                    <L7p:Properties mapValue="included">
                                    <L7p:entry>

                                    <L7p:key stringValue="RIGHT.COMMENT"/>

                                    <L7p:value stringValue="// Connect timeout"/>
                                    </L7p:entry>
                                    </L7p:Properties>
                                    </L7p:AssertionComment>

                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Expression1 stringValue="${httpRouting.reasonCode}"/>

                                    <L7p:ExpressionIsVariable booleanValue="false"/>
                                    <L7p:Operator operatorNull="null"/>
                                    <L7p:Predicates predicates="included">
                                    <L7p:item dataType="included">

                                    <L7p:Type variableDataType="int"/>
                                    </L7p:item>
                                    <L7p:item binary="included">

                                    <L7p:CaseSensitive booleanValue="false"/>

                                    <L7p:RightValue stringValue="-3"/>
                                    </L7p:item>
                                    </L7p:Predicates>
                                    </L7p:ComparisonAssertion>
                                    <L7p:HardcodedResponse>

                                    <L7p:Base64ResponseBody stringValue="PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiID8+IAogPElGX1JFUExZPgogCTxTRVJWSUNFX05BTUU+JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLnNlcnZpY2VOYW1lfTwvU0VSVklDRV9OQU1FPiAKIAk8UkVRVUVTVF9TVEFUVVM+CiAgCQk8U1RBVFVTPkVSUk9SPC9TVEFUVVM+IAogIAkJPFNUQVRVU19DT0RFPjI8L1NUQVRVU19DT0RFPiAKICAJCTxTVEFUVVNfTUVTU0FHRT5TUkI6UmVhZCBUaW1lb3V0IG9uICBTZW5kUmVjaWV2ZVJlY2VpdmU8L1NUQVRVU19NRVNTQUdFPiAKICAJPC9SRVFVRVNUX1NUQVRVUz4KICAJPFJFUVVFU1RfSUQ+JHtyZXNwb25zZVhwYXRoLnJlc3VsdH08L1JFUVVFU1RfSUQ+IAogIDwvSUZfUkVQTFk+"/>

                                    <L7p:EarlyResponse booleanValue="true"/>
                                    </L7p:HardcodedResponse>
                                    <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>

                                    <L7p:value stringValue="// Connect Timeout"/>
                                    </L7p:entry>
                                    </L7p:Properties>
                                    </L7p:assertionComment>
                                    </wsp:All>
                                    <wsp:All wsp:Usage="Required">
                                    <L7p:ComparisonAssertion>

                                    <L7p:AssertionComment assertionComment="included">

                                    <L7p:Properties mapValue="included">
                                    <L7p:entry>

                                    <L7p:key stringValue="RIGHT.COMMENT"/>

                                    <L7p:value stringValue="// Read timeout"/>
                                    </L7p:entry>
                                    </L7p:Properties>
                                    </L7p:AssertionComment>

                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Expression1 stringValue="${httpRouting.reasonCode}"/>

                                    <L7p:ExpressionIsVariable booleanValue="false"/>
                                    <L7p:Operator operatorNull="null"/>
                                    <L7p:Predicates predicates="included">
                                    <L7p:item dataType="included">

                                    <L7p:Type variableDataType="int"/>
                                    </L7p:item>
                                    <L7p:item binary="included">

                                    <L7p:CaseSensitive booleanValue="false"/>

                                    <L7p:RightValue stringValue="-4"/>
                                    </L7p:item>
                                    </L7p:Predicates>
                                    </L7p:ComparisonAssertion>
                                    <L7p:HardcodedResponse>

                                    <L7p:Base64ResponseBody stringValue="PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiID8+IAogPElGX1JFUExZPgogCTxTRVJWSUNFX05BTUU+JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLnNlcnZpY2VOYW1lfTwvU0VSVklDRV9OQU1FPiAKIAk8UkVRVUVTVF9TVEFUVVM+CiAgCQk8U1RBVFVTPkVSUk9SPC9TVEFUVVM+IAogIAkJPFNUQVRVU19DT0RFPjI8L1NUQVRVU19DT0RFPiAKICAJCTxTVEFUVVNfTUVTU0FHRT5TUkI6UmVhZCBUaW1lb3V0IG9uIFNlbmRSZWNlaXZlUmVjZWl2ZTwvU1RBVFVTX01FU1NBR0U+IAogIAk8L1JFUVVFU1RfU1RBVFVTPgogIAk8UkVRVUVTVF9JRD4ke3Jlc3BvbnNlWHBhdGgucmVzdWx0fTwvUkVRVUVTVF9JRD4gCiAgPC9JRl9SRVBMWT4="/>

                                    <L7p:EarlyResponse booleanValue="true"/>
                                    </L7p:HardcodedResponse>
                                    <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>

                                    <L7p:value stringValue="// Read Timeout"/>
                                    </L7p:entry>
                                    </L7p:Properties>
                                    </L7p:assertionComment>
                                    </wsp:All>
                                    <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// Timeout case"/>
                                    </L7p:entry>
                                    </L7p:Properties>
                                    </L7p:assertionComment>
                                    </wsp:OneOrMore>
                                    <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue=" // Handle Time Out response from Receive - Return TimeOut"/>
                                    </L7p:entry>
                                    </L7p:Properties>
                                    </L7p:assertionComment>
                                    </wsp:All>
                                    <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue=" // Perform Receive operation"/>
                                    </L7p:entry>
                                    </L7p:Properties>
                                    </L7p:assertionComment>
                                    </wsp:OneOrMore>
                                    <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// check for ETA and if so use Receive action"/>
                                    </L7p:entry>
                                    </L7p:Properties>
                                    </L7p:assertionComment>
                                </wsp:All>
                                <wsp:All wsp:Usage="Required">
                                    <L7p:ResponseXpathAssertion>
                                    <L7p:VariablePrefix stringValue=""/>
                                    <L7p:XmlMsgSrc stringValue="responseMsg"/>
                                    <L7p:XpathExpression xpathExpressionValue="included">
                                    <L7p:Expression stringValue="//ser:LegacyInvocationResponse/response"/>
                                    <L7p:Namespaces mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="ser"/>
                                    <L7p:value stringValue="http://www.orange.co.il/services"/>
                                    </L7p:entry>
                                    <L7p:entry>
                                    <L7p:key stringValue="s"/>
                                    <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                                    </L7p:entry>
                                    </L7p:Namespaces>
                                    <L7p:XpathVersion xpathVersion="XPATH_1_0"/>
                                    </L7p:XpathExpression>
                                    </L7p:ResponseXpathAssertion>
                                    <L7p:AuditDetailAssertion>
                                    <L7p:Detail stringValue="Return - ${responseXpath.result}"/>
                                    </L7p:AuditDetailAssertion>
                                    <L7p:HardcodedResponse>
                                    <L7p:Base64ResponseBody stringValue="JHtyZXNwb25zZVhwYXRoLnJlc3VsdH0="/>
                                    <L7p:EarlyResponse booleanValue="true"/>
                                    </L7p:HardcodedResponse>
                                    <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// if not ETA, return response"/>
                                    </L7p:entry>
                                    </L7p:Properties>
                                    </L7p:assertionComment>
                                </wsp:All>
                                <L7p:HardcodedResponse>
                                    <L7p:Base64ResponseBody stringValue="PElGX1JFUExZPjxTRVJWSUNFX05BTUU+JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLnNlcnZpY2VOYW1lfTwvU0VSVklDRV9OQU1FPjxSRVFVRVNUX1NUQVRVUz48U1RBVFVTPkVSUk9SPC9TVEFUVVM+PFNUQVRVU19DT0RFPi0xPC9TVEFUVVNfQ09ERT48U1RBVFVTX01FU1NBR0U+Q291bGQgbm90IHBlcmZvcm0gYXN5bmNoIHNlbmQgcmVjaWV2ZS4gU1I6JHtodHRwUm91dGluZy5yZWFzb25Db2RlfSAke3JlcXVlc3RJZH08L1NUQVRVU19NRVNTQUdFPjwvUkVRVUVTVF9TVEFUVVM+PC9JRl9SRVBMWT4="/>
                                    <L7p:EarlyResponse booleanValue="true"/>
                                </L7p:HardcodedResponse>
                                <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// check if there is a response or not"/>
                                    </L7p:entry>
                                    </L7p:Properties>
                                </L7p:assertionComment>
                            </wsp:OneOrMore>
                            <L7p:assertionComment>
                                <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="  // Create the XML and route to the service"/>
                                    </L7p:entry>
                                </L7p:Properties>
                            </L7p:assertionComment>
                        </wsp:All>
                        <wsp:All wsp:Usage="Required">
                            <L7p:Include>
                                <L7p:PolicyGuid stringValue="0a5e426c-983e-4787-a630-d12ed1632905"/>
                            </L7p:Include>
                            <L7p:HardcodedResponse>
                                <L7p:Base64ResponseBody stringValue="JHtqZGJjUXVlcnkucmV0dXJuX3ZhbHVlfQ=="/>
                            </L7p:HardcodedResponse>
                            <L7p:assertionComment>
                                <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="  // If failed to route, return error message"/>
                                    </L7p:entry>
                                </L7p:Properties>
                            </L7p:assertionComment>
                        </wsp:All>
                    </wsp:OneOrMore>
                    <L7p:assertionComment>
                        <L7p:Properties mapValue="included">
                            <L7p:entry>
                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                <L7p:value stringValue="SendReceive Action"/>
                            </L7p:entry>
                        </L7p:Properties>
                    </L7p:assertionComment>
                </wsp:All>
                <wsp:All wsp:Usage="Required">
                    <L7p:ComparisonAssertion>
                        <L7p:CaseSensitive booleanValue="false"/>
                        <L7p:Expression1 stringValue="${request.http.parameter.action}"/>
                        <L7p:ExpressionIsVariable booleanValue="false"/>
                        <L7p:MultivaluedComparison multivaluedComparison="FIRST"/>
                        <L7p:Operator operatorNull="null"/>
                        <L7p:Predicates predicates="included">
                            <L7p:item dataType="included">
                                <L7p:Type variableDataType="string"/>
                            </L7p:item>
                            <L7p:item binary="included">
                                <L7p:CaseSensitive booleanValue="false"/>
                                <L7p:RightValue stringValue="Send"/>
                            </L7p:item>
                        </L7p:Predicates>
                    </L7p:ComparisonAssertion>
                    <L7p:AuditDetailAssertion>
                        <L7p:Detail stringValue="Inside Send"/>
                        <L7p:Level stringValue="WARNING"/>
                    </L7p:AuditDetailAssertion>
                    <L7p:SetVariable>
                        <L7p:Base64Expression stringValue="U2VuZA=="/>
                        <L7p:VariableToSet stringValue="LegacyTraceAction"/>
                    </L7p:SetVariable>
                    <wsp:OneOrMore wsp:Usage="Required">
                        <wsp:All wsp:Usage="Required">
                            <L7p:ComparisonAssertion>
                                <L7p:CaseSensitive booleanValue="false"/>
                                <L7p:Expression1 stringValue="${request.http.parameter.serviceName}"/>
                                <L7p:ExpressionIsVariable booleanValue="false"/>
                                <L7p:Operator operatorNull="null"/>
                                <L7p:Predicates predicates="included">
                                    <L7p:item dataType="included">
                                    <L7p:Type variableDataType="string"/>
                                    </L7p:item>
                                    <L7p:item binary="included">
                                    <L7p:Negated booleanValue="true"/>
                                    <L7p:Operator operator="EMPTY"/>
                                    <L7p:RightValue stringValue=""/>
                                    </L7p:item>
                                </L7p:Predicates>
                            </L7p:ComparisonAssertion>
                            <L7p:SetVariable>
                                <L7p:Base64Expression stringValue="JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLnhtbFJlcXVlc3R9"/>
                                <L7p:VariableToSet stringValue="responseOut"/>
                            </L7p:SetVariable>
                            <wsp:OneOrMore wsp:Usage="Required">
                                <wsp:All wsp:Usage="Required">
                                    <L7p:ComparisonAssertion>
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Expression1 stringValue="${request.http.parameter.stub}"/>
                                    <L7p:ExpressionIsVariable booleanValue="false"/>
                                    <L7p:Operator operatorNull="null"/>
                                    <L7p:Predicates predicates="included">
                                    <L7p:item dataType="included">
                                    <L7p:Type variableDataType="boolean"/>
                                    </L7p:item>
                                    <L7p:item binary="included">
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:RightValue stringValue="true"/>
                                    </L7p:item>
                                    </L7p:Predicates>
                                    </L7p:ComparisonAssertion>
                                    <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="X1NUVUI="/>
                                    <L7p:VariableToSet stringValue="stub"/>
                                    </L7p:SetVariable>
                                    <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue=" // Handle stub=true"/>
                                    </L7p:entry>
                                    </L7p:Properties>
                                    </L7p:assertionComment>
                                </wsp:All>
                                <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue=""/>
                                    <L7p:VariableToSet stringValue="stub"/>
                                </L7p:SetVariable>
                                <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue=" // If a stub, route to the stub service"/>
                                    </L7p:entry>
                                    </L7p:Properties>
                                </L7p:assertionComment>
                            </wsp:OneOrMore>
                            <L7p:Include>
                                <L7p:PolicyGuid stringValue="9bb870ad-0b68-47c6-a7ba-4c1eff19a531"/>
                            </L7p:Include>
                            <wsp:OneOrMore wsp:Usage="Required">
                                <wsp:All wsp:Usage="Required">
                                    <L7p:ComparisonAssertion>
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Expression1 stringValue="${request.http.parameter.timeout}"/>
                                    <L7p:ExpressionIsVariable booleanValue="false"/>
                                    <L7p:Operator operatorNull="null"/>
                                    <L7p:Predicates predicates="included">
                                    <L7p:item dataType="included">
                                    <L7p:Type variableDataType="string"/>
                                    </L7p:item>
                                    <L7p:item binary="included">
                                    <L7p:Negated booleanValue="true"/>
                                    <L7p:Operator operator="EMPTY"/>
                                    <L7p:RightValue stringValue=""/>
                                    </L7p:item>
                                    <L7p:item regex="included">
                                    <L7p:Pattern stringValue="^\d+$"/>
                                    </L7p:item>
                                    </L7p:Predicates>
                                    </L7p:ComparisonAssertion>
                                    <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="PGNvbnN1bWVyVGltZW91dD4ke3JlcXVlc3QuaHR0cC5wYXJhbWV0ZXIudGltZW91dH08L2NvbnN1bWVyVGltZW91dD4="/>
                                    <L7p:VariableToSet stringValue="timeoutElement"/>
                                    </L7p:SetVariable>
                                </wsp:All>
                                <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue=""/>
                                    <L7p:VariableToSet stringValue="timeoutElement"/>
                                </L7p:SetVariable>
                            </wsp:OneOrMore>
                            <L7p:SetVariable>
                                <L7p:Base64Expression stringValue="PHNvYXBlbnY6RW52ZWxvcGUgeG1sbnM6c29hcGVudj0iaHR0cDovL3NjaGVtYXMueG1sc29hcC5vcmcvc29hcC9lbnZlbG9wZS8iIHhtbG5zOnNlcj0iaHR0cDovL3d3dy5vcmFuZ2UuY28uaWwvc2VydmljZXMiPg0KICAgPHNvYXBlbnY6SGVhZGVyLz4NCiAgIDxzb2FwZW52OkJvZHk+DQogICAgICA8c2VyOkludm9rZT4NCiAgICAgICAgIDxzZXJ2aWNlTmFtZT4ke3JlcXVlc3QuaHR0cC5wYXJhbWV0ZXIuc2VydmljZU5hbWV9PC9zZXJ2aWNlTmFtZT4NCiAgICAgICAgIDwhLS1Zb3UgaGF2ZSBhIENIT0lDRSBvZiB0aGUgbmV4dCAyIGl0ZW1zIGF0IHRoaXMgbGV2ZWwtLT4NCiAgICAgICAgIDxpbnZvY2F0aW9uUGFyYW1ldGVycz4NCiAgICAgICAgICAgIDwhLS1PcHRpb25hbDotLT4NCiAgICAgICAgICAgIDxhc3luYz50cnVlPC9hc3luYz4NCiAgICAgICAgICAgIDxhcmd1bWVudHM+DQogICAgICAgICAgICAgICA8aW5wdXQ+JHtyZXNwb25zZU91dH08L2lucHV0Pg0KICAgICAgICAgICAgPC9hcmd1bWVudHM+DQogICAgICAgICAgICAke3RpbWVvdXRFbGVtZW50fQ0KICAgICAgICAgICAgPHJlcU9yaWdpbj4ke3JlcXVlc3QuaHR0cC5wYXJhbWV0ZXIucmVxT3JpZ2lufTwvcmVxT3JpZ2luPg0KICAgICAgICAgICAgPHJlcU9yaWdpbkFwcD4ke3JlcXVlc3QuaHR0cC5wYXJhbWV0ZXIucmVxT3JpZ2luQXBwfTwvcmVxT3JpZ2luQXBwPg0KICAgICAgICAgICAgPHJlcU9yaWdpbmF0b3I+JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLnJlcU9yaWdpbmF0b3J9PC9yZXFPcmlnaW5hdG9yPg0KICAgICAgICAgPC9pbnZvY2F0aW9uUGFyYW1ldGVycz4NCiAgICAgIDwvc2VyOkludm9rZT4NCiAgIDwvc29hcGVudjpCb2R5Pg0KPC9zb2FwZW52OkVudmVsb3BlPg=="/>
                                <L7p:ContentType stringValue="text/xml; charset=utf-8"/>
                                <L7p:DataType variableDataType="message"/>
                                <L7p:VariableToSet stringValue="XMLRequest"/>
                            </L7p:SetVariable>
                            <L7p:CommentAssertion>
                                <L7p:Comment stringValue="Route the request wrapped in a SOAP message to the legacy service"/>
                            </L7p:CommentAssertion>
                            <wsp:OneOrMore wsp:Usage="Required">
                                <wsp:All wsp:Usage="Required">
                                    <L7p:ComparisonAssertion>
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Expression1 stringValue="${request.http.parameter.timeout}"/>
                                    <L7p:Operator operatorNull="null"/>
                                    <L7p:Predicates predicates="included">
                                    <L7p:item stringLength="included">
                                    <L7p:Max intValue="-1"/>
                                    <L7p:Min intValue="2"/>
                                    </L7p:item>
                                    </L7p:Predicates>
                                    </L7p:ComparisonAssertion>
                                    <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLnRpbWVvdXR9MDAw"/>
                                    <L7p:VariableToSet stringValue="consumerTimeout"/>
                                    </L7p:SetVariable>
                                    <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// Check if a timeout parameter is passed by the request."/>
                                    </L7p:entry>
                                    </L7p:Properties>
                                    </L7p:assertionComment>
                                </wsp:All>
                                <L7p:SetVariable>
                                    <L7p:AssertionComment assertionComment="included">
                                    <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// if the above is not set then use default setting from system"/>
                                    </L7p:entry>
                                    </L7p:Properties>
                                    </L7p:AssertionComment>
                                    <L7p:Base64Expression stringValue="JHtnYXRld2F5LnBhcnRuZXIuY29uZmlndXJhdGlvbi5jb25zdW1lclRpbWVvdXR9MDAw"/>
                                    <L7p:VariableToSet stringValue="consumerTimeout"/>
                                </L7p:SetVariable>
                                <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// checks what consumerTimeout to use for the HTTP assertion"/>
                                    </L7p:entry>
                                    </L7p:Properties>
                                </L7p:assertionComment>
                            </wsp:OneOrMore>
                            <wsp:OneOrMore wsp:Usage="Required">
                                <L7p:HttpRoutingAssertion>
                                    <L7p:AssertionComment assertionComment="included">
                                    <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue=" // using consumerTimeout here"/>
                                    </L7p:entry>
                                    </L7p:Properties>
                                    </L7p:AssertionComment>
                                    <L7p:ProtectedServiceUrl stringValue="http://localhost:18080/LegacyImported/${request.http.parameter.serviceName}${stub}?LegacyTraceAction=${LegacyTraceAction}"/>
                                    <L7p:ProxyPassword stringValueNull="null"/>
                                    <L7p:ProxyUsername stringValueNull="null"/>
                                    <L7p:RequestHeaderRules httpPassthroughRuleSet="included">
                                    <L7p:Rules httpPassthroughRules="included">
                                    <L7p:item httpPassthroughRule="included">
                                    <L7p:Name stringValue="Cookie"/>
                                    </L7p:item>
                                    <L7p:item httpPassthroughRule="included">
                                    <L7p:Name stringValue="SOAPAction"/>
                                    </L7p:item>
                                    </L7p:Rules>
                                    </L7p:RequestHeaderRules>
                                    <L7p:RequestMsgSrc stringValue="XMLRequest"/>
                                    <L7p:RequestParamRules httpPassthroughRuleSet="included">
                                    <L7p:ForwardAll booleanValue="true"/>
                                    <L7p:Rules httpPassthroughRules="included"/>
                                    </L7p:RequestParamRules>
                                    <L7p:ResponseHeaderRules httpPassthroughRuleSet="included">
                                    <L7p:Rules httpPassthroughRules="included">
                                    <L7p:item httpPassthroughRule="included">
                                    <L7p:Name stringValue="Set-Cookie"/>
                                    </L7p:item>
                                    </L7p:Rules>
                                    </L7p:ResponseHeaderRules>
                                    <L7p:ResponseMsgDest stringValue="responseMsg"/>
                                    <L7p:SamlAssertionVersion intValue="2"/>
                                    <L7p:Timeout stringValue="${consumerTimeout}"/>
                                </L7p:HttpRoutingAssertion>
                                <wsp:OneOrMore wsp:Usage="Required">
                                    <wsp:All wsp:Usage="Required">
                                    <L7p:AuditDetailAssertion>
                                    <L7p:Detail stringValue="SendReceive routing failure: httpRouting.reasonCode = ${httpRouting.reasonCode}"/>
                                    </L7p:AuditDetailAssertion>
                                    <L7p:ComparisonAssertion>
                                    <L7p:AssertionComment assertionComment="included">
                                    <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// Connect timeout"/>
                                    </L7p:entry>
                                    </L7p:Properties>
                                    </L7p:AssertionComment>
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Expression1 stringValue="${httpRouting.reasonCode}"/>
                                    <L7p:ExpressionIsVariable booleanValue="false"/>
                                    <L7p:Operator operatorNull="null"/>
                                    <L7p:Predicates predicates="included">
                                    <L7p:item dataType="included">
                                    <L7p:Type variableDataType="int"/>
                                    </L7p:item>
                                    <L7p:item binary="included">
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:RightValue stringValue="-3"/>
                                    </L7p:item>
                                    </L7p:Predicates>
                                    </L7p:ComparisonAssertion>
                                    <L7p:HardcodedResponse>
                                    <L7p:Base64ResponseBody stringValue="PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiID8+IAogPElGX1JFUExZPgogCTxTRVJWSUNFX05BTUU+JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLnNlcnZpY2VOYW1lfTwvU0VSVklDRV9OQU1FPiAKIAk8UkVRVUVTVF9TVEFUVVM+CiAgCQk8U1RBVFVTPkVSUk9SPC9TVEFUVVM+IAogIAkJPFNUQVRVU19DT0RFPjI8L1NUQVRVU19DT0RFPiAKICAJCTxTVEFUVVNfTUVTU0FHRT5TUkI6UmVhZCBUaW1lb3V0IG9uICBTZW5kPC9TVEFUVVNfTUVTU0FHRT4gCiAgCTwvUkVRVUVTVF9TVEFUVVM+CiAgCTxSRVFVRVNUX0lEPiR7cmVzcG9uc2VYcGF0aC5yZXN1bHR9PC9SRVFVRVNUX0lEPiAKICA8L0lGX1JFUExZPg=="/>
                                    </L7p:HardcodedResponse>
                                    <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// Connect Timeout"/>
                                    </L7p:entry>
                                    </L7p:Properties>
                                    </L7p:assertionComment>
                                    </wsp:All>
                                    <wsp:All wsp:Usage="Required">
                                    <L7p:ComparisonAssertion>
                                    <L7p:AssertionComment assertionComment="included">
                                    <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// Read timeout"/>
                                    </L7p:entry>
                                    </L7p:Properties>
                                    </L7p:AssertionComment>
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Expression1 stringValue="${httpRouting.reasonCode}"/>
                                    <L7p:ExpressionIsVariable booleanValue="false"/>
                                    <L7p:Operator operatorNull="null"/>
                                    <L7p:Predicates predicates="included">
                                    <L7p:item dataType="included">
                                    <L7p:Type variableDataType="int"/>
                                    </L7p:item>
                                    <L7p:item binary="included">
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:RightValue stringValue="-4"/>
                                    </L7p:item>
                                    </L7p:Predicates>
                                    </L7p:ComparisonAssertion>
                                    <L7p:HardcodedResponse>
                                    <L7p:Base64ResponseBody stringValue="PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiID8+IAogPElGX1JFUExZPgogCTxTRVJWSUNFX05BTUU+JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLnNlcnZpY2VOYW1lfTwvU0VSVklDRV9OQU1FPiAKIAk8UkVRVUVTVF9TVEFUVVM+CiAgCQk8U1RBVFVTPkVSUk9SPC9TVEFUVVM+IAogIAkJPFNUQVRVU19DT0RFPjI8L1NUQVRVU19DT0RFPiAKICAJCTxTVEFUVVNfTUVTU0FHRT5TUkI6UmVhZCBUaW1lb3V0IG9uIFNlbmQ8L1NUQVRVU19NRVNTQUdFPiAKICAJPC9SRVFVRVNUX1NUQVRVUz4KICAJPFJFUVVFU1RfSUQ+JHtyZXNwb25zZVhwYXRoLnJlc3VsdH08L1JFUVVFU1RfSUQ+IAogIDwvSUZfUkVQTFk+"/>
                                    </L7p:HardcodedResponse>
                                    <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// Read Timeout"/>
                                    </L7p:entry>
                                    </L7p:Properties>
                                    </L7p:assertionComment>
                                    </wsp:All>
                                    <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// Timeout case"/>
                                    </L7p:entry>
                                    </L7p:Properties>
                                    </L7p:assertionComment>
                                </wsp:OneOrMore>
                            </wsp:OneOrMore>
                            <L7p:AuditDetailAssertion>
                                <L7p:Detail stringValue="Respone = ${responseMsg.mainpart}"/>
                            </L7p:AuditDetailAssertion>
                            <L7p:ResponseXpathAssertion>
                                <L7p:VariablePrefix stringValue=""/>
                                <L7p:XmlMsgSrc stringValue="responseMsg"/>
                                <L7p:XpathExpression xpathExpressionValue="included">
                                    <L7p:Expression stringValue="/s:Envelope/s:Body/ser:LegacyInvocationResponse/requestId"/>
                                    <L7p:Namespaces mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="s"/>
                                    <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                                    </L7p:entry>
                                    <L7p:entry>
                                    <L7p:key stringValue="ser"/>
                                    <L7p:value stringValue="http://www.orange.co.il/services"/>
                                    </L7p:entry>
                                    </L7p:Namespaces>
                                    <L7p:XpathVersion xpathVersion="XPATH_1_0"/>
                                </L7p:XpathExpression>
                            </L7p:ResponseXpathAssertion>
                            <wsp:OneOrMore wsp:Usage="Required">
                                <wsp:All wsp:Usage="Required">
                                    <L7p:ComparisonAssertion>
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Expression1 stringValue="${responseXpath.result}"/>
                                    <L7p:Operator operatorNull="null"/>
                                    <L7p:Predicates predicates="included">
                                    <L7p:item dataType="included">
                                    <L7p:Type variableDataType="string"/>
                                    </L7p:item>
                                    <L7p:item stringLength="included"/>
                                    </L7p:Predicates>
                                    </L7p:ComparisonAssertion>
                                    <L7p:ResponseXpathAssertion>
                                    <L7p:VariablePrefix stringValue=""/>
                                    <L7p:XmlMsgSrc stringValue="responseMsg"/>
                                    <L7p:XpathExpression xpathExpressionValue="included">
                                    <L7p:Expression stringValue="/s:Envelope/s:Body/ser:LegacyInvocationResponse/response"/>
                                    <L7p:Namespaces mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="s"/>
                                    <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                                    </L7p:entry>
                                    <L7p:entry>
                                    <L7p:key stringValue="ser"/>
                                    <L7p:value stringValue="http://www.orange.co.il/services"/>
                                    </L7p:entry>
                                    </L7p:Namespaces>
                                    <L7p:XpathVersion xpathVersion="XPATH_1_0"/>
                                    </L7p:XpathExpression>
                                    </L7p:ResponseXpathAssertion>
                                    <L7p:HardcodedResponse>
                                    <L7p:Base64ResponseBody stringValue="JHtyZXNwb25zZVhwYXRoLnJlc3VsdH0="/>
                                    <L7p:EarlyResponse booleanValue="true"/>
                                    </L7p:HardcodedResponse>
                                    <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// If empty requestID, return response"/>
                                    </L7p:entry>
                                    </L7p:Properties>
                                    </L7p:assertionComment>
                                </wsp:All>
                                <wsp:All wsp:Usage="Required">
                                    <L7p:AuditDetailAssertion>
                                    <L7p:Detail stringValueReference="inline"><![CDATA[About to return = 
<IF_REPLY>
  <SERVICE_NAME>${request.http.parameter.serviceName}</SERVICE_NAME> 
  <REQUEST_STATUS>
    <STATUS>SUCCESS</STATUS> 
    <STATUS_CODE>0</STATUS_CODE> 
    <STATUS_MESSAGE /> 
  </REQUEST_STATUS>
  <REQUEST_ID>${responseXpath.result}</REQUEST_ID> 
</IF_REPLY>]]></L7p:Detail>
                                    </L7p:AuditDetailAssertion>
                                    <L7p:HardcodedResponse>
                                    <L7p:Base64ResponseBody stringValue="PElGX1JFUExZPgogIDxTRVJWSUNFX05BTUU+JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLnNlcnZpY2VOYW1lfTwvU0VSVklDRV9OQU1FPiAKICA8UkVRVUVTVF9TVEFUVVM+CiAgICA8U1RBVFVTPlNVQ0NFU1M8L1NUQVRVUz4gCiAgICA8U1RBVFVTX0NPREU+MDwvU1RBVFVTX0NPREU+IAogICAgPFNUQVRVU19NRVNTQUdFIC8+IAogIDwvUkVRVUVTVF9TVEFUVVM+CiAgPFJFUVVFU1RfSUQ+JHtyZXNwb25zZVhwYXRoLnJlc3VsdH08L1JFUVVFU1RfSUQ+IAo8L0lGX1JFUExZPg=="/>
                                    <L7p:EarlyResponse booleanValue="true"/>
                                    </L7p:HardcodedResponse>
                                    <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// Return requestID"/>
                                    </L7p:entry>
                                    </L7p:Properties>
                                    </L7p:assertionComment>
                                </wsp:All>
                                <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// Return error or requestID"/>
                                    </L7p:entry>
                                    </L7p:Properties>
                                </L7p:assertionComment>
                            </wsp:OneOrMore>
                        </wsp:All>
                        <L7p:HardcodedResponse>
                            <L7p:Base64ResponseBody stringValue="PElGX1JFUExZPjxTRVJWSUNFX05BTUU+JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLnNlcnZpY2VOYW1lfTwvU0VSVklDRV9OQU1FPjxSRVFVRVNUX1NUQVRVUz48U1RBVFVTPkVSUk9SPC9TVEFUVVM+PFNUQVRVU19DT0RFPi0xPC9TVEFUVVNfQ09ERT48U1RBVFVTX01FU1NBR0U+Q291bGQgbm90IHBlcmZvcm0gcmVxdWVzdC4gUzoke2h0dHBSb3V0aW5nLnJlYXNvbkNvZGV9ICR7cmVxdWVzdElkfTwvU1RBVFVTX01FU1NBR0U+CjxERUJVR19JTkZPPiR7cmVzcG9uc2VNc2cubWFpbnBhcnR9PC9ERUJVR19JTkZPPjwvUkVRVUVTVF9TVEFUVVM+PC9JRl9SRVBMWT4="/>
                        </L7p:HardcodedResponse>
                    </wsp:OneOrMore>
                    <L7p:assertionComment>
                        <L7p:Properties mapValue="included">
                            <L7p:entry>
                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                <L7p:value stringValue="Send Action"/>
                            </L7p:entry>
                        </L7p:Properties>
                    </L7p:assertionComment>
                </wsp:All>
                <wsp:All wsp:Usage="Required">
                    <L7p:ComparisonAssertion>
                        <L7p:CaseSensitive booleanValue="false"/>
                        <L7p:Expression1 stringValue="${request.http.parameter.action}"/>
                        <L7p:ExpressionIsVariable booleanValue="false"/>
                        <L7p:MultivaluedComparison multivaluedComparison="FIRST"/>
                        <L7p:Operator operatorNull="null"/>
                        <L7p:Predicates predicates="included">
                            <L7p:item dataType="included">
                                <L7p:Type variableDataType="string"/>
                            </L7p:item>
                            <L7p:item binary="included">
                                <L7p:CaseSensitive booleanValue="false"/>
                                <L7p:RightValue stringValue="Receive"/>
                            </L7p:item>
                        </L7p:Predicates>
                    </L7p:ComparisonAssertion>
                    <L7p:AuditDetailAssertion>
                        <L7p:Detail stringValue="Inside Receive"/>
                        <L7p:Level stringValue="WARNING"/>
                    </L7p:AuditDetailAssertion>
                    <L7p:SetVariable>
                        <L7p:Base64Expression stringValue="UmVjZWl2ZQ=="/>
                        <L7p:VariableToSet stringValue="LegacyTraceAction"/>
                    </L7p:SetVariable>
                    <wsp:OneOrMore wsp:Usage="Required">
                        <wsp:All wsp:Usage="Required">
                            <L7p:ComparisonAssertion>
                                <L7p:CaseSensitive booleanValue="false"/>
                                <L7p:Expression1 stringValue="${request.http.parameter.stub}"/>
                                <L7p:ExpressionIsVariable booleanValue="false"/>
                                <L7p:Operator operatorNull="null"/>
                                <L7p:Predicates predicates="included">
                                    <L7p:item dataType="included">
                                    <L7p:Type variableDataType="boolean"/>
                                    </L7p:item>
                                    <L7p:item binary="included">
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:RightValue stringValue="true"/>
                                    </L7p:item>
                                </L7p:Predicates>
                            </L7p:ComparisonAssertion>
                            <L7p:SetVariable>
                                <L7p:Base64Expression stringValue="X1NUVUI="/>
                                <L7p:VariableToSet stringValue="stub"/>
                            </L7p:SetVariable>
                            <L7p:assertionComment>
                                <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue=" // Handle stub=true"/>
                                    </L7p:entry>
                                </L7p:Properties>
                            </L7p:assertionComment>
                        </wsp:All>
                        <L7p:SetVariable>
                            <L7p:Base64Expression stringValue=""/>
                            <L7p:VariableToSet stringValue="stub"/>
                        </L7p:SetVariable>
                        <L7p:assertionComment>
                            <L7p:Properties mapValue="included">
                                <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue=" // If a stub, route to the stub service"/>
                                </L7p:entry>
                            </L7p:Properties>
                        </L7p:assertionComment>
                    </wsp:OneOrMore>
                    <wsp:OneOrMore wsp:Usage="Required">
                        <wsp:OneOrMore L7p:Enabled="false" wsp:Usage="Required">
                            <L7p:ComparisonAssertion>
                                <L7p:CaseSensitive booleanValue="false"/>
                                <L7p:Enabled booleanValue="false"/>
                                <L7p:Expression1 stringValue="${request.http.parameter.requestID}"/>
                                <L7p:ExpressionIsVariable booleanValue="false"/>
                                <L7p:Operator operatorNull="null"/>
                                <L7p:Predicates predicates="included">
                                    <L7p:item dataType="included">
                                    <L7p:Type variableDataType="string"/>
                                    </L7p:item>
                                    <L7p:item binary="included">
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Negated booleanValue="true"/>
                                    <L7p:Operator operator="EMPTY"/>
                                    <L7p:RightValue stringValue=""/>
                                    </L7p:item>
                                </L7p:Predicates>
                            </L7p:ComparisonAssertion>
                            <L7p:HardcodedResponse>
                                <L7p:Base64ResponseBody stringValue="PElGX1JFUExZPjxTRVJWSUNFX05BTUU+PC9TRVJWSUNFX05BTUU+PFJFUVVFU1RfU1RBVFVTPjxTVEFUVVM+RVJST1I8L1NUQVRVUz48U1RBVFVTX0NPREU+LTE8L1NUQVRVU19DT0RFPjxTVEFUVVNfTUVTU0FHRT5QYXJhbWV0ZXIgcmVxdWVzdElEIGlzIHJlcXVpcmVkLjwvU1RBVFVTX01FU1NBR0U+PC9SRVFVRVNUX1NUQVRVUz48L0lGX1JFUExZPg=="/>
                                <L7p:Enabled booleanValue="false"/>
                            </L7p:HardcodedResponse>
                        </wsp:OneOrMore>
                        <wsp:All wsp:Usage="Required">
                            <L7p:ComparisonAssertion>
                                <L7p:CaseSensitive booleanValue="false"/>
                                <L7p:Expression1 stringValue="${request.http.parameter.requestID}"/>
                                <L7p:ExpressionIsVariable booleanValue="false"/>
                                <L7p:Operator operatorNull="null"/>
                                <L7p:Predicates predicates="included">
                                    <L7p:item dataType="included">
                                    <L7p:Type variableDataType="string"/>
                                    </L7p:item>
                                    <L7p:item binary="included">
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Operator operator="EMPTY"/>
                                    <L7p:RightValue stringValue=""/>
                                    </L7p:item>
                                </L7p:Predicates>
                            </L7p:ComparisonAssertion>
                            <L7p:HardcodedResponse>
                                <L7p:Base64ResponseBody stringValue="PElGX1JFUExZPjxTRVJWSUNFX05BTUU+PC9TRVJWSUNFX05BTUU+PFJFUVVFU1RfU1RBVFVTPjxTVEFUVVM+RVJST1I8L1NUQVRVUz48U1RBVFVTX0NPREU+LTE8L1NUQVRVU19DT0RFPjxTVEFUVVNfTUVTU0FHRT5QYXJhbWV0ZXIgcmVxdWVzdElEIGlzIHJlcXVpcmVkLjwvU1RBVFVTX01FU1NBR0U+PC9SRVFVRVNUX1NUQVRVUz48L0lGX1JFUExZPg=="/>
                            </L7p:HardcodedResponse>
                            <L7p:assertionComment>
                                <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="  // check if requestId == empty -> return empty"/>
                                    </L7p:entry>
                                </L7p:Properties>
                            </L7p:assertionComment>
                        </wsp:All>
                        <wsp:All wsp:Usage="Required">
                            <L7p:AuditDetailAssertion>
                                <L7p:Detail stringValue="Getting info from localhost http://localhost:8080/LegacyGetServiceName?requestID=${request.http.parameter.requestID}"/>
                            </L7p:AuditDetailAssertion>
                            <wsp:OneOrMore L7p:Enabled="false" wsp:Usage="Required">
                                <wsp:All wsp:Usage="Required">
                                    <L7p:HttpRoutingAssertion>
                                    <L7p:PassThroughSoapFaults booleanValue="false"/>
                                    <L7p:ProtectedServiceUrl stringValue="http://localhost:8080/LegacyGetServiceName?requestID=${request.http.parameter.requestID}"/>
                                    <L7p:ProxyPassword stringValueNull="null"/>
                                    <L7p:ProxyUsername stringValueNull="null"/>
                                    <L7p:RequestHeaderRules httpPassthroughRuleSet="included">
                                    <L7p:Rules httpPassthroughRules="included">
                                    <L7p:item httpPassthroughRule="included">
                                    <L7p:Name stringValue="Cookie"/>
                                    </L7p:item>
                                    <L7p:item httpPassthroughRule="included">
                                    <L7p:Name stringValue="SOAPAction"/>
                                    </L7p:item>
                                    </L7p:Rules>
                                    </L7p:RequestHeaderRules>
                                    <L7p:RequestParamRules httpPassthroughRuleSet="included">
                                    <L7p:ForwardAll booleanValue="true"/>
                                    <L7p:Rules httpPassthroughRules="included"/>
                                    </L7p:RequestParamRules>
                                    <L7p:ResponseHeaderRules httpPassthroughRuleSet="included">
                                    <L7p:Rules httpPassthroughRules="included">
                                    <L7p:item httpPassthroughRule="included">
                                    <L7p:Name stringValue="Set-Cookie"/>
                                    </L7p:item>
                                    </L7p:Rules>
                                    </L7p:ResponseHeaderRules>
                                    <L7p:ResponseMsgDest stringValue="serviceName"/>
                                    <L7p:SamlAssertionVersion intValue="2"/>
                                    </L7p:HttpRoutingAssertion>
                                    <L7p:AuditDetailAssertion>
                                    <L7p:Detail stringValue="Got info from localhost, service is ${servicename.mainpart}"/>
                                    </L7p:AuditDetailAssertion>
                                    <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="JHtzZXJ2aWNlTmFtZS5tYWlucGFydH0="/>
                                    <L7p:VariableToSet stringValue="ServiceName"/>
                                    </L7p:SetVariable>
                                    <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// Route to GetServiceName"/>
                                    </L7p:entry>
                                    </L7p:Properties>
                                    </L7p:assertionComment>
                                </wsp:All>
                                <L7p:SetVariable>
                                    <L7p:AssertionComment assertionComment="included">
                                    <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// If routing to GetServiceName failed on infrastructure issue, cause the rest to fail gracefully"/>
                                    </L7p:entry>
                                    </L7p:Properties>
                                    </L7p:AssertionComment>
                                    <L7p:Base64Expression stringValue="Tm8gc3VjaCByZXF1ZXN0IElE"/>
                                    <L7p:VariableToSet stringValue="ServiceName"/>
                                </L7p:SetVariable>
                                <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValueReference="inline"><![CDATA[//not needed anymore since get response does not need service name
// Find the service name]]></L7p:value>
                                    </L7p:entry>
                                    </L7p:Properties>
                                </L7p:assertionComment>
                            </wsp:OneOrMore>
                            <wsp:OneOrMore L7p:Enabled="false" wsp:Usage="Required">
                                <L7p:ComparisonAssertion>
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Expression1 stringValue="${ServiceName}"/>
                                    <L7p:MultivaluedComparison multivaluedComparison="FAIL"/>
                                    <L7p:Operator operatorNull="null"/>
                                    <L7p:Predicates predicates="included">
                                    <L7p:item dataType="included">
                                    <L7p:Type variableDataType="string"/>
                                    </L7p:item>
                                    <L7p:item binary="included">
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Negated booleanValue="true"/>
                                    <L7p:Operator operator="CONTAINS"/>
                                    <L7p:RightValue stringValue="No such request ID"/>
                                    </L7p:item>
                                    </L7p:Predicates>
                                </L7p:ComparisonAssertion>
                                <wsp:All wsp:Usage="Required">
                                    <L7p:HardcodedResponse>
                                    <L7p:Base64ResponseBody stringValue="PElGX1JFUExZPjxTRVJWSUNFX05BTUU+PC9TRVJWSUNFX05BTUU+PFJFUVVFU1RfU1RBVFVTPjxTVEFUVVM+RVJST1I8L1NUQVRVUz48U1RBVFVTX0NPREU+LTE8L1NUQVRVU19DT0RFPjxTVEFUVVNfTUVTU0FHRT5ObyBTdWNoIFJlcXVlc3QgSUQ8L1NUQVRVU19NRVNTQUdFPjwvUkVRVUVTVF9TVEFUVVM+PC9JRl9SRVBMWT4="/>
                                    <L7p:EarlyResponse booleanValue="true"/>
                                    </L7p:HardcodedResponse>
                                    <L7p:FalseAssertion/>
                                </wsp:All>
                                <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue=" // wrong requestId found"/>
                                    </L7p:entry>
                                    </L7p:Properties>
                                </L7p:assertionComment>
                            </wsp:OneOrMore>
                            <L7p:SetVariable>
                                <L7p:Base64Expression stringValue="PHNvYXBlbnY6RW52ZWxvcGUgeG1sbnM6c29hcGVudj0iaHR0cDovL3NjaGVtYXMueG1sc29hcC5vcmcvc29hcC9lbnZlbG9wZS8iIHhtbG5zOnNlcj0iaHR0cDovL3d3dy5vcmFuZ2UuY28uaWwvc2VydmljZXMiPg0KICAgPHNvYXBlbnY6SGVhZGVyLz4NCiAgIDxzb2FwZW52OkJvZHk+DQogICAgICA8c2VyOkdldFJlc3BvbnNlPg0KICAgICAgICAgPHNlcnZpY2VOYW1lPiR7c2VydmljZW5hbWV9PC9zZXJ2aWNlTmFtZT4NCiAgICAgICAgIDxyZXF1ZXN0SWQ+JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLnJlcXVlc3RJRH08L3JlcXVlc3RJZD4NCiAgICAgIDwvc2VyOkdldFJlc3BvbnNlPg0KICAgPC9zb2FwZW52OkJvZHk+DQo8L3NvYXBlbnY6RW52ZWxvcGU+"/>
                                <L7p:ContentType stringValue="text/xml; charset=utf-8"/>
                                <L7p:DataType variableDataType="message"/>
                                <L7p:VariableToSet stringValue="XMLRequest"/>
                            </L7p:SetVariable>
                            <L7p:AuditDetailAssertion>
                                <L7p:Detail stringValue="${XMLRequest.mainpart}"/>
                            </L7p:AuditDetailAssertion>
                            <L7p:AuditDetailAssertion>
                                <L7p:Detail stringValue="Routing thru http://localhost:8080/LegacyImported/${serviceName}${stub}"/>
                                <L7p:Enabled booleanValue="false"/>
                            </L7p:AuditDetailAssertion>
                            <L7p:CommentAssertion>
                                <L7p:Comment stringValue="refactored to &quot;Legacy - Get Response by ID fragment&quot;, requires only ${partner.requestID}"/>
                            </L7p:CommentAssertion>
                            <L7p:SetVariable>
                                <L7p:Base64Expression stringValue="JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLnJlcXVlc3RJRH0="/>
                                <L7p:VariableToSet stringValue="partner.requestId"/>
                            </L7p:SetVariable>
                            <L7p:SetVariable>
                                <L7p:AssertionComment assertionComment="included">
                                    <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="LEFT.COMMENT"/>
                                    <L7p:value stringValue="hardcoded to 80ms since service is not known after refactoring 06/08/13"/>
                                    </L7p:entry>
                                    </L7p:Properties>
                                </L7p:AssertionComment>
                                <L7p:Base64Expression stringValue="ODA="/>
                                <L7p:VariableToSet stringValue="config.eta"/>
                            </L7p:SetVariable>
                            <L7p:Include>
                                <L7p:PolicyGuid stringValue="317ddcb2-f89d-4db4-ae1a-0e29ddef31c8"/>
                            </L7p:Include>
                            <L7p:SetVariable>
                                <L7p:Base64Expression stringValue="JHtvdXRwdXR9"/>
                                <L7p:ContentType stringValue="text/xml; charset=utf-8"/>
                                <L7p:DataType variableDataType="message"/>
                                <L7p:VariableToSet stringValue="responseMsg"/>
                            </L7p:SetVariable>
                            <L7p:AuditDetailAssertion>
                                <L7p:Detail stringValue="responseMsg=: ${responseMsg.mainpart}"/>
                                <L7p:Level stringValue="WARNING"/>
                            </L7p:AuditDetailAssertion>
                            <L7p:Include>
                                <L7p:PolicyGuid stringValue="f7faf570-d59b-454d-9a43-d963c760acb6"/>
                            </L7p:Include>
                        </wsp:All>
                        <L7p:HardcodedResponse>
                            <L7p:Base64ResponseBody stringValue="PElGX1JFUExZPjxTRVJWSUNFX05BTUU+JHtzZXJ2aWNlbmFtZS5tYWlucGFydH08L1NFUlZJQ0VfTkFNRT48UkVRVUVTVF9TVEFUVVM+PFNUQVRVUz5FUlJPUjwvU1RBVFVTPjxTVEFUVVNfQ09ERT4tMTwvU1RBVFVTX0NPREU+PFNUQVRVU19NRVNTQUdFPlVuYWJsZSB0byByZXRyaWV2ZSByZXNwb25zZS4gJHtyZXF1ZXN0SWR9PC9TVEFUVVNfTUVTU0FHRT48L1JFUVVFU1RfU1RBVFVTPjwvSUZfUkVQTFk+"/>
                        </L7p:HardcodedResponse>
                    </wsp:OneOrMore>
                    <L7p:assertionComment>
                        <L7p:Properties mapValue="included">
                            <L7p:entry>
                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                <L7p:value stringValue="Receive Action"/>
                            </L7p:entry>
                        </L7p:Properties>
                    </L7p:assertionComment>
                </wsp:All>
                <wsp:All wsp:Usage="Required">
                    <L7p:ComparisonAssertion>
                        <L7p:CaseSensitive booleanValue="false"/>
                        <L7p:Expression1 stringValue="${request.http.parameters.action}"/>
                        <L7p:ExpressionIsVariable booleanValue="false"/>
                        <L7p:MultivaluedComparison multivaluedComparison="FIRST"/>
                        <L7p:Operator operatorNull="null"/>
                        <L7p:Predicates predicates="included">
                            <L7p:item dataType="included">
                                <L7p:Type variableDataType="string"/>
                            </L7p:item>
                            <L7p:item binary="included">
                                <L7p:CaseSensitive booleanValue="false"/>
                                <L7p:RightValue stringValue="GetStatus"/>
                            </L7p:item>
                        </L7p:Predicates>
                    </L7p:ComparisonAssertion>
                    <L7p:AuditDetailAssertion>
                        <L7p:Detail stringValue="Choose if requestid is not there or it is there or else, just could not perform the request"/>
                    </L7p:AuditDetailAssertion>
                    <L7p:AuditDetailAssertion>
                        <L7p:Detail stringValue="Inside GetStatus"/>
                        <L7p:Level stringValue="WARNING"/>
                    </L7p:AuditDetailAssertion>
                    <L7p:SetVariable>
                        <L7p:Base64Expression stringValue="R2V0U3RhdHVz"/>
                        <L7p:VariableToSet stringValue="LegacyTraceAction"/>
                    </L7p:SetVariable>
                    <wsp:OneOrMore wsp:Usage="Required">
                        <wsp:All wsp:Usage="Required">
                            <L7p:AuditDetailAssertion>
                                <L7p:Detail stringValue="Found request ID"/>
                            </L7p:AuditDetailAssertion>
                            <L7p:ComparisonAssertion>
                                <L7p:CaseSensitive booleanValue="false"/>
                                <L7p:Expression1 stringValue="${request.http.parameter.requestID}"/>
                                <L7p:ExpressionIsVariable booleanValue="false"/>
                                <L7p:Operator operatorNull="null"/>
                                <L7p:Predicates predicates="included">
                                    <L7p:item dataType="included">
                                    <L7p:Type variableDataType="string"/>
                                    </L7p:item>
                                    <L7p:item binary="included">
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Operator operator="EMPTY"/>
                                    <L7p:RightValue stringValue=""/>
                                    </L7p:item>
                                </L7p:Predicates>
                            </L7p:ComparisonAssertion>
                            <L7p:HardcodedResponse>
                                <L7p:Base64ResponseBody stringValue="PElGX1JFUExZPjxTRVJWSUNFX05BTUU+PC9TRVJWSUNFX05BTUU+PFJFUVVFU1RfU1RBVFVTPjxTVEFUVVM+RVJST1I8L1NUQVRVUz48U1RBVFVTX0NPREU+LTE8L1NUQVRVU19DT0RFPjxTVEFUVVNfTUVTU0FHRT5QYXJhbWV0ZXIgcmVxdWVzdElEIGlzIHJlcXVpcmVkLjwvU1RBVFVTX01FU1NBR0U+PC9SRVFVRVNUX1NUQVRVUz48L0lGX1JFUExZPg=="/>
                                <L7p:EarlyResponse booleanValue="true"/>
                            </L7p:HardcodedResponse>
                        </wsp:All>
                        <wsp:OneOrMore wsp:Usage="Required">
                            <wsp:All wsp:Usage="Required">
                                <L7p:HttpRoutingAssertion>
                                    <L7p:PassThroughSoapFaults booleanValue="false"/>
                                    <L7p:ProtectedServiceUrl stringValue="http://localhost:8080/LegacyGetServiceName?requestID=${request.http.parameter.requestID}"/>
                                    <L7p:ProxyPassword stringValueNull="null"/>
                                    <L7p:ProxyUsername stringValueNull="null"/>
                                    <L7p:RequestHeaderRules httpPassthroughRuleSet="included">
                                    <L7p:Rules httpPassthroughRules="included">
                                    <L7p:item httpPassthroughRule="included">
                                    <L7p:Name stringValue="Cookie"/>
                                    </L7p:item>
                                    <L7p:item httpPassthroughRule="included">
                                    <L7p:Name stringValue="SOAPAction"/>
                                    </L7p:item>
                                    </L7p:Rules>
                                    </L7p:RequestHeaderRules>
                                    <L7p:RequestParamRules httpPassthroughRuleSet="included">
                                    <L7p:ForwardAll booleanValue="true"/>
                                    <L7p:Rules httpPassthroughRules="included"/>
                                    </L7p:RequestParamRules>
                                    <L7p:ResponseHeaderRules httpPassthroughRuleSet="included">
                                    <L7p:Rules httpPassthroughRules="included">
                                    <L7p:item httpPassthroughRule="included">
                                    <L7p:Name stringValue="Set-Cookie"/>
                                    </L7p:item>
                                    </L7p:Rules>
                                    </L7p:ResponseHeaderRules>
                                    <L7p:ResponseMsgDest stringValue="serviceName"/>
                                    <L7p:SamlAssertionVersion intValue="2"/>
                                </L7p:HttpRoutingAssertion>
                                <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="JHtzZXJ2aWNlTmFtZS5tYWlucGFydH0="/>
                                    <L7p:VariableToSet stringValue="ServiceName"/>
                                </L7p:SetVariable>
                                <wsp:OneOrMore wsp:Usage="Required">
                                    <L7p:ComparisonAssertion>
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Expression1 stringValue="${ServiceName}"/>
                                    <L7p:MultivaluedComparison multivaluedComparison="FAIL"/>
                                    <L7p:Operator operatorNull="null"/>
                                    <L7p:Predicates predicates="included">
                                    <L7p:item dataType="included">
                                    <L7p:Type variableDataType="string"/>
                                    </L7p:item>
                                    <L7p:item binary="included">
                                    <L7p:CaseSensitive booleanValue="false"/>
                                    <L7p:Negated booleanValue="true"/>
                                    <L7p:Operator operator="CONTAINS"/>
                                    <L7p:RightValue stringValue="No such request ID"/>
                                    </L7p:item>
                                    </L7p:Predicates>
                                    </L7p:ComparisonAssertion>
                                    <L7p:HardcodedResponse>
                                    <L7p:Base64ResponseBody stringValue="PElGX1JFUExZPjxTRVJWSUNFX05BTUU+PC9TRVJWSUNFX05BTUU+PFJFUVVFU1RfU1RBVFVTPjxTVEFUVVM+RVJST1I8L1NUQVRVUz48U1RBVFVTX0NPREU+LTE8L1NUQVRVU19DT0RFPjxTVEFUVVNfTUVTU0FHRT5ObyBTdWNoIFJlcXVlc3QgSUQ8L1NUQVRVU19NRVNTQUdFPjwvUkVRVUVTVF9TVEFUVVM+PC9JRl9SRVBMWT4="/>
                                    <L7p:EarlyResponse booleanValue="true"/>
                                    <L7p:ResponseStatus stringValue="400"/>
                                    </L7p:HardcodedResponse>
                                    <L7p:AuditDetailAssertion>
                                    <L7p:Detail stringValue="Found Service name for that request"/>
                                    </L7p:AuditDetailAssertion>
                                </wsp:OneOrMore>
                                <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="PHNvYXBlbnY6RW52ZWxvcGUgeG1sbnM6c29hcGVudj0iaHR0cDovL3NjaGVtYXMueG1sc29hcC5vcmcvc29hcC9lbnZlbG9wZS8iIHhtbG5zOnNlcj0iaHR0cDovL3d3dy5vcmFuZ2UuY28uaWwvc2VydmljZXMiPg0KICAgPHNvYXBlbnY6SGVhZGVyLz4NCiAgIDxzb2FwZW52OkJvZHk+DQogICAgICA8c2VyOkdldFJlc3BvbnNlPg0KICAgICAgICAgPHNlcnZpY2VOYW1lPiR7c2VydmljZU5hbWV9PC9zZXJ2aWNlTmFtZT4NCiAgICAgICAgIDxyZXF1ZXN0SWQ+JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLnJlcXVlc3RJZH08L3JlcXVlc3RJZD4NCiAgICAgIDwvc2VyOkdldFJlc3BvbnNlPg0KICAgPC9zb2FwZW52OkJvZHk+DQo8L3NvYXBlbnY6RW52ZWxvcGU+"/>
                                    <L7p:ContentType stringValue="text/xml; charset=utf-8"/>
                                    <L7p:DataType variableDataType="message"/>
                                    <L7p:VariableToSet stringValue="XMLRequest"/>
                                </L7p:SetVariable>
                                <L7p:AuditDetailAssertion>
                                    <L7p:Detail stringValue="Routing through service"/>
                                </L7p:AuditDetailAssertion>
                                <L7p:HttpRoutingAssertion>
                                    <L7p:PassThroughSoapFaults booleanValue="false"/>
                                    <L7p:ProtectedServiceUrl stringValue="http://localhost:8080/LegacyImported/${servicename}?LegacyTraceAction=${LegacyTraceAction}"/>
                                    <L7p:ProxyPassword stringValueNull="null"/>
                                    <L7p:ProxyUsername stringValueNull="null"/>
                                    <L7p:RequestHeaderRules httpPassthroughRuleSet="included">
                                    <L7p:Rules httpPassthroughRules="included">
                                    <L7p:item httpPassthroughRule="included">
                                    <L7p:Name stringValue="Cookie"/>
                                    </L7p:item>
                                    <L7p:item httpPassthroughRule="included">
                                    <L7p:Name stringValue="SOAPAction"/>
                                    </L7p:item>
                                    </L7p:Rules>
                                    </L7p:RequestHeaderRules>
                                    <L7p:RequestMsgSrc stringValue="XMLRequest"/>
                                    <L7p:RequestParamRules httpPassthroughRuleSet="included">
                                    <L7p:ForwardAll booleanValue="true"/>
                                    <L7p:Rules httpPassthroughRules="included"/>
                                    </L7p:RequestParamRules>
                                    <L7p:ResponseHeaderRules httpPassthroughRuleSet="included">
                                    <L7p:Rules httpPassthroughRules="included">
                                    <L7p:item httpPassthroughRule="included">
                                    <L7p:Name stringValue="Set-Cookie"/>
                                    </L7p:item>
                                    </L7p:Rules>
                                    </L7p:ResponseHeaderRules>
                                    <L7p:ResponseMsgDest stringValue="finalResponse"/>
                                    <L7p:SamlAssertionVersion intValue="2"/>
                                </L7p:HttpRoutingAssertion>
                                <L7p:AuditDetailAssertion>
                                    <L7p:Detail stringValue="Finished Routing through service"/>
                                </L7p:AuditDetailAssertion>
                                <wsp:OneOrMore wsp:Usage="Required">
                                    <wsp:All wsp:Usage="Required">
                                    <L7p:AuditDetailAssertion>
                                    <L7p:Detail stringValue="See if there is an error"/>
                                    </L7p:AuditDetailAssertion>
                                    <L7p:Regex>
                                    <L7p:AutoTarget booleanValue="false"/>
                                    <L7p:CaseInsensitive booleanValue="true"/>

                                    <L7p:OtherTargetMessageVariable stringValue="finalResponse.mainpart"/>
                                    <L7p:Regex stringValue="&lt;/SERVICE_NAME>.*&lt;REQUEST_STATUS>.*&lt;STATUS>ERROR"/>
                                    <L7p:RegexName stringValue="Checking if there is an ERROR at highest level"/>
                                    <L7p:Replacement stringValue=""/>
                                    <L7p:Target target="OTHER"/>
                                    </L7p:Regex>
                                    <L7p:HardcodedResponse>
                                    <L7p:Base64ResponseBody stringValue="JHtmaW5hbFJlc3BvbnNlLm1haW5wYXJ0fQ=="/>
                                    </L7p:HardcodedResponse>
                                    </wsp:All>
                                    <wsp:All wsp:Usage="Required">
                                    <L7p:AuditDetailAssertion>
                                    <L7p:Detail stringValue="There is no error, writing out answer"/>
                                    </L7p:AuditDetailAssertion>
                                    <L7p:HardcodedResponse>
                                    <L7p:Base64ResponseBody stringValue="PElGX1JFUExZPgogIDxSRVFVRVNUX1NUQVRVUz4KICAgIDxTVEFUVVM+U1VDQ0VTUzwvU1RBVFVTPiAKICAgIDxTVEFUVVNfQ09ERT4zPC9TVEFUVVNfQ09ERT4gCiAgICA8U1RBVFVTX01FU1NBR0UgLz4gCiAgPC9SRVFVRVNUX1NUQVRVUz4KICA8UkVRVUVTVF9JRD4ke3JlcXVlc3QuaHR0cC5wYXJhbWV0ZXIucmVxdWVzdElEfTwvUkVRVUVTVF9JRD4gCjwvSUZfUkVQTFk+"/>
                                    </L7p:HardcodedResponse>
                                    </wsp:All>
                                </wsp:OneOrMore>
                                <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// check if servicename exists"/>
                                    </L7p:entry>
                                    </L7p:Properties>
                                </L7p:assertionComment>
                            </wsp:All>
                            <L7p:HardcodedResponse>
                                <L7p:Base64ResponseBody stringValue="PElGX1JFUExZPjxTRVJWSUNFX05BTUU+JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLnNlcnZpY2VOYW1lfTwvU0VSVklDRV9OQU1FPjxSRVFVRVNUX1NUQVRVUz48U1RBVFVTPkVSUk9SPC9TVEFUVVM+PFNUQVRVU19DT0RFPi0xPC9TVEFUVVNfQ09ERT48U1RBVFVTX01FU1NBR0U+Q291bGQgbm90IHBlcmZvcm0gcmVxdWVzdCAyLiAke3JlcXVlc3RJZH08L1NUQVRVU19NRVNTQUdFPjwvUkVRVUVTVF9TVEFUVVM+PC9JRl9SRVBMWT4="/>
                            </L7p:HardcodedResponse>
                        </wsp:OneOrMore>
                        <L7p:HardcodedResponse>
                            <L7p:Base64ResponseBody stringValue="PElGX1JFUExZPjxTRVJWSUNFX05BTUU+JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLnNlcnZpY2VOYW1lfTwvU0VSVklDRV9OQU1FPjxSRVFVRVNUX1NUQVRVUz48U1RBVFVTPkVSUk9SPC9TVEFUVVM+PFNUQVRVU19DT0RFPi0xPC9TVEFUVVNfQ09ERT48U1RBVFVTX01FU1NBR0U+Q291bGQgbm90IHBlcmZvcm0gcmVxdWVzdC4gJHtyZXF1ZXN0SWR9PC9TVEFUVVNfTUVTU0FHRT48L1JFUVVFU1RfU1RBVFVTPjwvSUZfUkVQTFk+"/>
                        </L7p:HardcodedResponse>
                    </wsp:OneOrMore>
                    <L7p:assertionComment>
                        <L7p:Properties mapValue="included">
                            <L7p:entry>
                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                <L7p:value stringValue="GetStatus action"/>
                            </L7p:entry>
                        </L7p:Properties>
                    </L7p:assertionComment>
                </wsp:All>
                <wsp:All wsp:Usage="Required">
                    <L7p:ComparisonAssertion>
                        <L7p:CaseSensitive booleanValue="false"/>
                        <L7p:Expression1 stringValue="${request.http.parameters.action}"/>
                        <L7p:ExpressionIsVariable booleanValue="false"/>
                        <L7p:MultivaluedComparison multivaluedComparison="FIRST"/>
                        <L7p:Operator operatorNull="null"/>
                        <L7p:Predicates predicates="included">
                            <L7p:item dataType="included">
                                <L7p:Type variableDataType="string"/>
                            </L7p:item>
                            <L7p:item binary="included">
                                <L7p:CaseSensitive booleanValue="false"/>
                                <L7p:RightValue stringValue="Resend"/>
                            </L7p:item>
                        </L7p:Predicates>
                    </L7p:ComparisonAssertion>
                    <L7p:AuditDetailAssertion>
                        <L7p:Detail stringValue="Inside Resend"/>
                    </L7p:AuditDetailAssertion>
                    <L7p:SetVariable>
                        <L7p:Base64Expression stringValue="UmVzZW5k"/>
                        <L7p:VariableToSet stringValue="LegacyTraceAction"/>
                    </L7p:SetVariable>
                    <wsp:OneOrMore wsp:Usage="Required">
                        <wsp:All wsp:Usage="Required">
                            <L7p:ComparisonAssertion>
                                <L7p:CaseSensitive booleanValue="false"/>
                                <L7p:Expression1 stringValue="${request.http.parameter.requestID}"/>
                                <L7p:ExpressionIsVariable booleanValue="false"/>
                                <L7p:Operator operatorNull="null"/>
                                <L7p:Predicates predicates="included">
                                    <L7p:item dataType="included">
                                    <L7p:Type variableDataType="string"/>
                                    </L7p:item>
                                    <L7p:item binary="included">
                                    <L7p:Negated booleanValue="true"/>
                                    <L7p:Operator operator="EMPTY"/>
                                    <L7p:RightValue stringValue=""/>
                                    </L7p:item>
                                </L7p:Predicates>
                            </L7p:ComparisonAssertion>
                            <L7p:HttpRoutingAssertion>
                                <L7p:PassThroughSoapFaults booleanValue="false"/>
                                <L7p:ProtectedServiceUrl stringValue="http://localhost:8080/LegacyGetServiceName?requestID=${request.http.parameter.requestID}"/>
                                <L7p:ProxyPassword stringValueNull="null"/>
                                <L7p:ProxyUsername stringValueNull="null"/>
                                <L7p:RequestHeaderRules httpPassthroughRuleSet="included">
                                    <L7p:Rules httpPassthroughRules="included">
                                    <L7p:item httpPassthroughRule="included">
                                    <L7p:Name stringValue="Cookie"/>
                                    </L7p:item>
                                    <L7p:item httpPassthroughRule="included">
                                    <L7p:Name stringValue="SOAPAction"/>
                                    </L7p:item>
                                    </L7p:Rules>
                                </L7p:RequestHeaderRules>
                                <L7p:RequestParamRules httpPassthroughRuleSet="included">
                                    <L7p:ForwardAll booleanValue="true"/>
                                    <L7p:Rules httpPassthroughRules="included"/>
                                </L7p:RequestParamRules>
                                <L7p:ResponseHeaderRules httpPassthroughRuleSet="included">
                                    <L7p:Rules httpPassthroughRules="included">
                                    <L7p:item httpPassthroughRule="included">
                                    <L7p:Name stringValue="Set-Cookie"/>
                                    </L7p:item>
                                    </L7p:Rules>
                                </L7p:ResponseHeaderRules>
                                <L7p:ResponseMsgDest stringValue="serviceName"/>
                                <L7p:SamlAssertionVersion intValue="2"/>
                            </L7p:HttpRoutingAssertion>
                            <L7p:SetVariable>
                                <L7p:Base64Expression stringValue="JHtzZXJ2aWNlTmFtZS5tYWlucGFydH0="/>
                                <L7p:VariableToSet stringValue="ServiceName"/>
                            </L7p:SetVariable>
                            <L7p:ComparisonAssertion>
                                <L7p:CaseSensitive booleanValue="false"/>
                                <L7p:Expression1 stringValue="${ServiceName}"/>
                                <L7p:MultivaluedComparison multivaluedComparison="FAIL"/>
                                <L7p:Operator operatorNull="null"/>
                                <L7p:Predicates predicates="included">
                                    <L7p:item dataType="included">
                                    <L7p:Type variableDataType="string"/>
                                    </L7p:item>
                                    <L7p:item binary="included">
                                    <L7p:Negated booleanValue="true"/>
                                    <L7p:Operator operator="CONTAINS"/>
                                    <L7p:RightValue stringValue="No such request ID"/>
                                    </L7p:item>
                                </L7p:Predicates>
                            </L7p:ComparisonAssertion>
                            <wsp:OneOrMore wsp:Usage="Required">
                                <wsp:All wsp:Usage="Required">
                                    <L7p:AuditDetailAssertion>
                                    <L7p:Detail stringValue="Requesting a receive to itself"/>
                                    <L7p:Enabled booleanValue="false"/>
                                    </L7p:AuditDetailAssertion>
                                    <L7p:HttpRoutingAssertion>
                                    <L7p:Enabled booleanValue="false"/>
                                    <L7p:ProtectedServiceUrl stringValue="http://localhost:8080/?action=receive&amp;requestID=${http.request.parameter.requestID}"/>
                                    <L7p:ProxyPassword stringValueNull="null"/>
                                    <L7p:ProxyUsername stringValueNull="null"/>
                                    <L7p:RequestHeaderRules httpPassthroughRuleSet="included">
                                    <L7p:Rules httpPassthroughRules="included">
                                    <L7p:item httpPassthroughRule="included">
                                    <L7p:Name stringValue="Cookie"/>
                                    </L7p:item>
                                    <L7p:item httpPassthroughRule="included">
                                    <L7p:Name stringValue="SOAPAction"/>
                                    </L7p:item>
                                    </L7p:Rules>
                                    </L7p:RequestHeaderRules>
                                    <L7p:RequestParamRules httpPassthroughRuleSet="included">
                                    <L7p:ForwardAll booleanValue="true"/>
                                    <L7p:Rules httpPassthroughRules="included"/>
                                    </L7p:RequestParamRules>
                                    <L7p:ResponseHeaderRules httpPassthroughRuleSet="included">
                                    <L7p:Rules httpPassthroughRules="included">
                                    <L7p:item httpPassthroughRule="included">
                                    <L7p:Name stringValue="Set-Cookie"/>
                                    </L7p:item>
                                    </L7p:Rules>
                                    </L7p:ResponseHeaderRules>
                                    <L7p:ResponseMsgDest stringValue="responseMsg1"/>
                                    <L7p:SamlAssertionVersion intValue="2"/>
                                    <L7p:Timeout stringValue="300000"/>
                                    </L7p:HttpRoutingAssertion>
                                    <L7p:AuditDetailAssertion>
                                    <L7p:Detail stringValue="Getting response"/>
                                    <L7p:Enabled booleanValue="false"/>
                                    </L7p:AuditDetailAssertion>
                                    <L7p:AuditDetailAssertion>
                                    <L7p:Detail stringValue="${responsemsg1.mainpart}"/>
                                    <L7p:Enabled booleanValue="false"/>
                                    </L7p:AuditDetailAssertion>
                                    <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="JHtyZXNwb25zZU1zZzEubWFpbnBhcnR9"/>
                                    <L7p:Enabled booleanValue="false"/>
                                    <L7p:VariableToSet stringValue="responseOut"/>
                                    </L7p:SetVariable>
                                    <L7p:AuditDetailAssertion>
                                    <L7p:Detail stringValueReference="inline"><![CDATA[SELECT 	REQ_XML_REQUEST, 
	REQ_ORIGIN, 
	REQ_ORIGINATOR, 
	REQ_ORIGINAPP,
	REQ_CORRELATION_ID,
	REQ_CANCEL_TIMEOUT
FROM REQUESTS WHERE REQ_ID=${request.http.parameter.requestID}]]></L7p:Detail>
                                    </L7p:AuditDetailAssertion>
                                    <L7p:JdbcQuery>
                                    <L7p:ConnectionName stringValue="Tracer Database"/>
                                    <L7p:MaxRecords intValue="1"/>
                                    <L7p:SqlQuery stringValueReference="inline"><![CDATA[SELECT 	REQ_XML_REQUEST, 
	REQ_ORIGIN, 
	REQ_ORIGINATOR, 
	REQ_ORIGINAPP,
	REQ_CORRELATION_ID,
	REQ_CANCEL_TIMEOUT
FROM REQUESTS WHERE REQ_ID=${request.http.parameter.requestID}]]></L7p:SqlQuery>
                                    </L7p:JdbcQuery>
                                    <L7p:AuditDetailAssertion>
                                    <L7p:Detail stringValue="${jdbcQuery.req_xml_request}"/>
                                    </L7p:AuditDetailAssertion>
                                    <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="JHtqZGJjUXVlcnkucmVxX3htbF9yZXF1ZXN0fQ=="/>
                                    <L7p:VariableToSet stringValue="responseOut"/>
                                    </L7p:SetVariable>
                                    <L7p:Include>
                                    <L7p:PolicyGuid stringValue="9bb870ad-0b68-47c6-a7ba-4c1eff19a531"/>
                                    </L7p:Include>
                                    <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="PHNvYXBlbnY6RW52ZWxvcGUgeG1sbnM6c29hcGVudj0iaHR0cDovL3NjaGVtYXMueG1sc29hcC5vcmcvc29hcC9lbnZlbG9wZS8iIHhtbG5zOnNlcj0iaHR0cDovL3d3dy5vcmFuZ2UuY28uaWwvc2VydmljZXMiPg0KICAgPHNvYXBlbnY6SGVhZGVyLz4NCiAgIDxzb2FwZW52OkJvZHk+DQogICAgICA8c2VyOkludm9rZT4NCiAgICAgICAgIDxzZXJ2aWNlTmFtZT4ke3NlcnZpY2VOYW1lfTwvc2VydmljZU5hbWU+DQogICAgICAgICA8aW52b2NhdGlvblBhcmFtZXRlcnM+DQogICAgICAgICAgICA8YXN5bmM+ZmFsc2U8L2FzeW5jPg0KICAgICAgICAgICAgPGFyZ3VtZW50cz4NCiAgICAgICAgICAgICAgIDxpbnB1dD4ke3Jlc3BvbnNlT3V0fTwvaW5wdXQ+DQogICAgICAgICAgICA8L2FyZ3VtZW50cz4NCiAgICAgICAgICAgIDxyZXFPcmlnaW4+JHtqZGJjUXVlcnkucmVxX29yaWdpbn08L3JlcU9yaWdpbj4NCiAgICAgICAgICAgIDxyZXFPcmlnaW5BcHA+JHtqZGJjUXVlcnkucmVxX29yaWdpbkFwcH08L3JlcU9yaWdpbkFwcD4NCiAgICAgICAgICAgIDxyZXFPcmlnaW5hdG9yPiR7amRiY1F1ZXJ5LnJlcV9vcmlnaW5hdG9yfTwvcmVxT3JpZ2luYXRvcj4NCiAgICAgICAgICAgIDxjb25zdW1lclRpbWVvdXQ+JHtqZGJjUXVlcnkucmVxX2NhbmNlbF90aW1lb3V0fTwvY29uc3VtZXJUaW1lb3V0Pg0KICAgICAgICAgICAgPGNvcnJlbGF0aW9uSWQ+JHtqZGJjUXVlcnkucmVxX2NvcnJlbGF0aW9uX2lkfTwvY29ycmVsYXRpb25JZD4NCiAgICAgICAgICAgIDxmb3JjZVN5bmM+dHJ1ZTwvZm9yY2VTeW5jPg0KICAgICAgICAgPC9pbnZvY2F0aW9uUGFyYW1ldGVycz4NCiAgICAgIDwvc2VyOkludm9rZT4NCiAgIDwvc29hcGVudjpCb2R5Pg0KPC9zb2FwZW52OkVudmVsb3BlPg=="/>
                                    <L7p:ContentType stringValue="text/xml; charset=utf-8"/>
                                    <L7p:DataType variableDataType="message"/>
                                    <L7p:VariableToSet stringValue="XMLRequest"/>
                                    </L7p:SetVariable>
                                    <L7p:AuditDetailAssertion>
                                    <L7p:Detail stringValue="${XmlRequest.mainpart}"/>
                                    </L7p:AuditDetailAssertion>
                                    <L7p:HttpRoutingAssertion>
                                    <L7p:ProtectedServiceUrl stringValue="http://localhost:8080/LegacyImported/${serviceName}?LegacyTraceAction=${LegacyTraceAction}"/>
                                    <L7p:ProxyPassword stringValueNull="null"/>
                                    <L7p:ProxyUsername stringValueNull="null"/>
                                    <L7p:RequestHeaderRules httpPassthroughRuleSet="included">
                                    <L7p:Rules httpPassthroughRules="included">
                                    <L7p:item httpPassthroughRule="included">
                                    <L7p:Name stringValue="Cookie"/>
                                    </L7p:item>
                                    <L7p:item httpPassthroughRule="included">
                                    <L7p:Name stringValue="SOAPAction"/>
                                    </L7p:item>
                                    </L7p:Rules>
                                    </L7p:RequestHeaderRules>
                                    <L7p:RequestMsgSrc stringValue="XMLRequest"/>
                                    <L7p:RequestParamRules httpPassthroughRuleSet="included">
                                    <L7p:ForwardAll booleanValue="true"/>
                                    <L7p:Rules httpPassthroughRules="included"/>
                                    </L7p:RequestParamRules>
                                    <L7p:ResponseHeaderRules httpPassthroughRuleSet="included">
                                    <L7p:Rules httpPassthroughRules="included">
                                    <L7p:item httpPassthroughRule="included">
                                    <L7p:Name stringValue="Set-Cookie"/>
                                    </L7p:item>
                                    </L7p:Rules>
                                    </L7p:ResponseHeaderRules>
                                    <L7p:ResponseMsgDest stringValue="responseMsg"/>
                                    <L7p:SamlAssertionVersion intValue="2"/>
                                    <L7p:Timeout stringValue="300000"/>
                                    </L7p:HttpRoutingAssertion>
                                    <L7p:ResponseXpathAssertion>
                                    <L7p:VariablePrefix stringValue=""/>
                                    <L7p:XmlMsgSrc stringValue="responseMsg"/>
                                    <L7p:XpathExpression xpathExpressionValue="included">
                                    <L7p:Expression stringValue="/s:Envelope/s:Body/ser:LegacyInvocationResponse/response/text()"/>
                                    <L7p:Namespaces mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="ser"/>
                                    <L7p:value stringValue="http://www.orange.co.il/services"/>
                                    </L7p:entry>
                                    <L7p:entry>
                                    <L7p:key stringValue="s"/>
                                    <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                                    </L7p:entry>
                                    </L7p:Namespaces>
                                    <L7p:XpathVersion xpathVersion="XPATH_1_0"/>
                                    </L7p:XpathExpression>
                                    </L7p:ResponseXpathAssertion>
                                    <L7p:RemoteCacheStore>
                                    <L7p:CacheEntryKey stringValue="${request.http.parameter.requestID}-${gateway.partner.environment}-response"/>
                                    <L7p:MaxEntryAge stringValue="30000"/>
                                    <L7p:MaxEntrySizeBytes stringValue="100000"/>
                                    <L7p:OtherTargetMessageVariable stringValue="responseXpath.result"/>
                                    <L7p:RemoteCacheId longValue="11567104"/>
                                    <L7p:Target target="OTHER"/>
                                    </L7p:RemoteCacheStore>
                                    <L7p:HardcodedResponse>
                                    <L7p:Base64ResponseBody stringValue="JHtyZXNwb25zZVhwYXRoLnJlc3VsdH0="/>
                                    </L7p:HardcodedResponse>
                                    <L7p:assertionComment>
                                    <L7p:Properties mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="RIGHT.COMMENT"/>
                                    <L7p:value stringValue="// using itself's receive action to get what it needs."/>
                                    </L7p:entry>
                                    </L7p:Properties>
                                    </L7p:assertionComment>
                                </wsp:All>
                                <L7p:HardcodedResponse>
                                    <L7p:Base64ResponseBody stringValue="PElGX1JFUExZPjxTRVJWSUNFX05BTUU+JHtzZXJ2aWNlbmFtZS5tYWlucGFydH08L1NFUlZJQ0VfTkFNRT48UkVRVUVTVF9TVEFUVVM+PFNUQVRVUz5FUlJPUjwvU1RBVFVTPjxTVEFUVVNfQ09ERT4tMTwvU1RBVFVTX0NPREU+PFNUQVRVU19NRVNTQUdFPlVuYWJsZSB0byByZXRyaWV2ZSByZXNwb25zZSAyLjwvU1RBVFVTX01FU1NBR0U+PC9SRVFVRVNUX1NUQVRVUz48L0lGX1JFUExZPg=="/>
                                </L7p:HardcodedResponse>
                            </wsp:OneOrMore>
                        </wsp:All>
                        <L7p:HardcodedResponse>
                            <L7p:Base64ResponseBody stringValue="PElGX1JFUExZPjxTRVJWSUNFX05BTUU+JHtzZXJ2aWNlbmFtZS5tYWlucGFydH08L1NFUlZJQ0VfTkFNRT48UkVRVUVTVF9TVEFUVVM+PFNUQVRVUz5FUlJPUjwvU1RBVFVTPjxTVEFUVVNfQ09ERT4tMTwvU1RBVFVTX0NPREU+PFNUQVRVU19NRVNTQUdFPlVuYWJsZSB0byByZXRyaWV2ZSByZXNwb25zZS48L1NUQVRVU19NRVNTQUdFPjwvUkVRVUVTVF9TVEFUVVM+PC9JRl9SRVBMWT4="/>
                        </L7p:HardcodedResponse>
                    </wsp:OneOrMore>
                    <L7p:assertionComment>
                        <L7p:Properties mapValue="included">
                            <L7p:entry>
                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                <L7p:value stringValue="Resend action"/>
                            </L7p:entry>
                        </L7p:Properties>
                    </L7p:assertionComment>
                </wsp:All>
                <wsp:All wsp:Usage="Required">
                    <L7p:ComparisonAssertion>
                        <L7p:CaseSensitive booleanValue="false"/>
                        <L7p:Expression1 stringValue="${request.http.parameters.action}"/>
                        <L7p:ExpressionIsVariable booleanValue="false"/>
                        <L7p:MultivaluedComparison multivaluedComparison="FIRST"/>
                        <L7p:Operator operatorNull="null"/>
                        <L7p:Predicates predicates="included">
                            <L7p:item dataType="included">
                                <L7p:Type variableDataType="string"/>
                            </L7p:item>
                            <L7p:item binary="included">
                                <L7p:CaseSensitive booleanValue="false"/>
                                <L7p:RightValue stringValue="Retry"/>
                            </L7p:item>
                        </L7p:Predicates>
                    </L7p:ComparisonAssertion>
                    <L7p:AuditDetailAssertion>
                        <L7p:Detail stringValue="Inside Retry"/>
                    </L7p:AuditDetailAssertion>
                    <L7p:SetVariable>
                        <L7p:Base64Expression stringValue="UmV0cnk="/>
                        <L7p:VariableToSet stringValue="LegacyTraceAction"/>
                    </L7p:SetVariable>
                    <wsp:OneOrMore wsp:Usage="Required">
                        <wsp:All wsp:Usage="Required">
                            <L7p:ComparisonAssertion>
                                <L7p:CaseSensitive booleanValue="false"/>
                                <L7p:Expression1 stringValue="${request.http.parameter.requestID}"/>
                                <L7p:ExpressionIsVariable booleanValue="false"/>
                                <L7p:Operator operatorNull="null"/>
                                <L7p:Predicates predicates="included">
                                    <L7p:item dataType="included">
                                    <L7p:Type variableDataType="string"/>
                                    </L7p:item>
                                    <L7p:item binary="included">
                                    <L7p:Negated booleanValue="true"/>
                                    <L7p:Operator operator="EMPTY"/>
                                    <L7p:RightValue stringValue=""/>
                                    </L7p:item>
                                </L7p:Predicates>
                            </L7p:ComparisonAssertion>
                            <L7p:HttpRoutingAssertion>
                                <L7p:PassThroughSoapFaults booleanValue="false"/>
                                <L7p:ProtectedServiceUrl stringValue="http://localhost:8080/LegacyGetServiceName?requestID=${request.http.parameter.requestID}"/>
                                <L7p:ProxyPassword stringValueNull="null"/>
                                <L7p:ProxyUsername stringValueNull="null"/>
                                <L7p:RequestHeaderRules httpPassthroughRuleSet="included">
                                    <L7p:Rules httpPassthroughRules="included">
                                    <L7p:item httpPassthroughRule="included">
                                    <L7p:Name stringValue="Cookie"/>
                                    </L7p:item>
                                    <L7p:item httpPassthroughRule="included">
                                    <L7p:Name stringValue="SOAPAction"/>
                                    </L7p:item>
                                    </L7p:Rules>
                                </L7p:RequestHeaderRules>
                                <L7p:RequestParamRules httpPassthroughRuleSet="included">
                                    <L7p:ForwardAll booleanValue="true"/>
                                    <L7p:Rules httpPassthroughRules="included"/>
                                </L7p:RequestParamRules>
                                <L7p:ResponseHeaderRules httpPassthroughRuleSet="included">
                                    <L7p:Rules httpPassthroughRules="included">
                                    <L7p:item httpPassthroughRule="included">
                                    <L7p:Name stringValue="Set-Cookie"/>
                                    </L7p:item>
                                    </L7p:Rules>
                                </L7p:ResponseHeaderRules>
                                <L7p:ResponseMsgDest stringValue="serviceName"/>
                                <L7p:SamlAssertionVersion intValue="2"/>
                            </L7p:HttpRoutingAssertion>
                            <L7p:SetVariable>
                                <L7p:Base64Expression stringValue="JHtzZXJ2aWNlTmFtZS5tYWlucGFydH0="/>
                                <L7p:VariableToSet stringValue="ServiceName"/>
                            </L7p:SetVariable>
                            <L7p:AuditDetailAssertion>
                                <L7p:Detail stringValue="^^^^^^^^^^^^ ${ServiceName}"/>
                            </L7p:AuditDetailAssertion>
                            <L7p:ComparisonAssertion>
                                <L7p:CaseSensitive booleanValue="false"/>
                                <L7p:Expression1 stringValue="${ServiceName}"/>
                                <L7p:MultivaluedComparison multivaluedComparison="FAIL"/>
                                <L7p:Operator operatorNull="null"/>
                                <L7p:Predicates predicates="included">
                                    <L7p:item dataType="included">
                                    <L7p:Type variableDataType="string"/>
                                    </L7p:item>
                                    <L7p:item binary="included">
                                    <L7p:Negated booleanValue="true"/>
                                    <L7p:Operator operator="CONTAINS"/>
                                    <L7p:RightValue stringValue="No such request ID"/>
                                    </L7p:item>
                                </L7p:Predicates>
                            </L7p:ComparisonAssertion>
                            <wsp:OneOrMore wsp:Usage="Required">
                                <wsp:All wsp:Usage="Required">
                                    <L7p:JdbcQuery>
                                    <L7p:ConnectionName stringValue="${config.connection}"/>
                                    <L7p:Enabled booleanValue="false"/>
                                    <L7p:MaxRecords intValue="1"/>
                                    <L7p:SqlQuery stringValueReference="inline"><![CDATA[SELECT 	REQ_XML_REQUEST, 
	REQ_ORIGIN, 
	REQ_ORIGINATOR, 
	REQ_ORIGINAPP,
	REQ_CORRELATION_ID,
	REQ_CANCEL_TIMEOUT
FROM REQUESTS WHERE REQ_ID=${request.http.parameter.requestID}]]></L7p:SqlQuery>
                                    </L7p:JdbcQuery>
                                    <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="JHtqZGJjUXVlcnkucmVxX3htbF9yZXF1ZXN0fQ=="/>
                                    <L7p:VariableToSet stringValue="responseOut"/>
                                    </L7p:SetVariable>
                                    <L7p:Include>
                                    <L7p:PolicyGuid stringValue="9bb870ad-0b68-47c6-a7ba-4c1eff19a531"/>
                                    </L7p:Include>
                                    <L7p:SetVariable>
                                    <L7p:Base64Expression stringValue="PHNvYXBlbnY6RW52ZWxvcGUgeG1sbnM6c29hcGVudj0iaHR0cDovL3NjaGVtYXMueG1sc29hcC5vcmcvc29hcC9lbnZlbG9wZS8iIHhtbG5zOnNlcj0iaHR0cDovL3d3dy5vcmFuZ2UuY28uaWwvc2VydmljZXMiPg0KICAgPHNvYXBlbnY6SGVhZGVyLz4NCiAgIDxzb2FwZW52OkJvZHk+DQogICAgICA8c2VyOkludm9rZT4NCiAgICAgICAgIDxzZXJ2aWNlTmFtZT4ke3NlcnZpY2VOYW1lfTwvc2VydmljZU5hbWU+DQoJPHJlcXVlc3RJZD4ke3JlcXVlc3QuaHR0cC5wYXJhbWV0ZXIucmVxdWVzdElEfTwvcmVxdWVzdElkPg0KICAgICAgICAgPGludm9jYXRpb25QYXJhbWV0ZXJzPg0KICAgICAgICAgICAgPGFzeW5jPmZhbHNlPC9hc3luYz4NCiAgICAgICAgICAgIDxhcmd1bWVudHM+DQogICAgICAgICAgICAgICA8aW5wdXQ+JHtyZXNwb25zZU91dH08L2lucHV0Pg0KICAgICAgICAgICAgPC9hcmd1bWVudHM+DQogICAgICAgICAgICA8cmVxT3JpZ2luPiR7amRiY1F1ZXJ5LnJlcV9vcmlnaW59PC9yZXFPcmlnaW4+DQogICAgICAgICAgICA8cmVxT3JpZ2luQXBwPiR7amRiY1F1ZXJ5LnJlcV9vcmlnaW5BcHB9PC9yZXFPcmlnaW5BcHA+DQogICAgICAgICAgICA8cmVxT3JpZ2luYXRvcj4ke2pkYmNRdWVyeS5yZXFfb3JpZ2luYXRvcn08L3JlcU9yaWdpbmF0b3I+DQogICAgICAgICAgICA8Y29uc3VtZXJUaW1lb3V0PiR7amRiY1F1ZXJ5LnJlcV9jYW5jZWxfdGltZW91dH08L2NvbnN1bWVyVGltZW91dD4NCiAgICAgICAgICAgIDxjb3JyZWxhdGlvbklkPiR7amRiY1F1ZXJ5LnJlcV9jb3JyZWxhdGlvbl9pZH08L2NvcnJlbGF0aW9uSWQ+DQogICAgICAgICAgICA8Zm9yY2VTeW5jPnRydWU8L2ZvcmNlU3luYz4NCiAgICAgICAgIDwvaW52b2NhdGlvblBhcmFtZXRlcnM+DQogICAgICA8L3NlcjpJbnZva2U+DQogICA8L3NvYXBlbnY6Qm9keT4NCjwvc29hcGVudjpFbnZlbG9wZT4="/>
                                    <L7p:ContentType stringValue="text/xml; charset=utf-8"/>
                                    <L7p:DataType variableDataType="message"/>
                                    <L7p:VariableToSet stringValue="XMLRequest"/>
                                    </L7p:SetVariable>
                                    <L7p:AuditDetailAssertion>
                                    <L7p:Detail stringValue="XMLRequest.mainpart = ${XMLRequest.mainpart}"/>
                                    </L7p:AuditDetailAssertion>
                                    <L7p:HttpRoutingAssertion>
                                    <L7p:ProtectedServiceUrl stringValue="http://localhost:8080/LegacyImported/${serviceName}?LegacyTraceAction=${LegacyTraceAction}"/>
                                    <L7p:ProxyPassword stringValueNull="null"/>
                                    <L7p:ProxyUsername stringValueNull="null"/>
                                    <L7p:RequestHeaderRules httpPassthroughRuleSet="included">
                                    <L7p:Rules httpPassthroughRules="included">
                                    <L7p:item httpPassthroughRule="included">
                                    <L7p:Name stringValue="Cookie"/>
                                    </L7p:item>
                                    <L7p:item httpPassthroughRule="included">
                                    <L7p:Name stringValue="SOAPAction"/>
                                    </L7p:item>
                                    </L7p:Rules>
                                    </L7p:RequestHeaderRules>
                                    <L7p:RequestMsgSrc stringValue="XMLRequest"/>
                                    <L7p:RequestParamRules httpPassthroughRuleSet="included">
                                    <L7p:ForwardAll booleanValue="true"/>
                                    <L7p:Rules httpPassthroughRules="included"/>
                                    </L7p:RequestParamRules>
                                    <L7p:ResponseHeaderRules httpPassthroughRuleSet="included">
                                    <L7p:Rules httpPassthroughRules="included">
                                    <L7p:item httpPassthroughRule="included">
                                    <L7p:Name stringValue="Set-Cookie"/>
                                    </L7p:item>
                                    </L7p:Rules>
                                    </L7p:ResponseHeaderRules>
                                    <L7p:ResponseMsgDest stringValue="responseMsg"/>
                                    <L7p:SamlAssertionVersion intValue="2"/>
                                    <L7p:Timeout stringValue="300000"/>
                                    </L7p:HttpRoutingAssertion>
                                    <L7p:ResponseXpathAssertion>
                                    <L7p:VariablePrefix stringValue=""/>
                                    <L7p:XmlMsgSrc stringValue="responseMsg"/>
                                    <L7p:XpathExpression xpathExpressionValue="included">
                                    <L7p:Expression stringValue="/s:Envelope/s:Body/ser:LegacyInvocationResponse/response/text()"/>
                                    <L7p:Namespaces mapValue="included">
                                    <L7p:entry>
                                    <L7p:key stringValue="ser"/>
                                    <L7p:value stringValue="http://www.orange.co.il/services"/>
                                    </L7p:entry>
                                    <L7p:entry>
                                    <L7p:key stringValue="s"/>
                                    <L7p:value stringValue="http://schemas.xmlsoap.org/soap/envelope/"/>
                                    </L7p:entry>
                                    </L7p:Namespaces>
                                    <L7p:XpathVersion xpathVersion="XPATH_1_0"/>
                                    </L7p:XpathExpression>
                                    </L7p:ResponseXpathAssertion>
                                    <L7p:RemoteCacheStore>
                                    <L7p:CacheEntryKey stringValue="${request.http.parameter.requestID}-${gateway.partner.environment}-response"/>
                                    <L7p:MaxEntryAge stringValue="30000"/>
                                    <L7p:MaxEntrySizeBytes stringValue="100000"/>
                                    <L7p:OtherTargetMessageVariable stringValue="responseXpath.result"/>
                                    <L7p:RemoteCacheId longValue="11567104"/>
                                    <L7p:Target target="OTHER"/>
                                    </L7p:RemoteCacheStore>
                                    <L7p:HardcodedResponse>
                                    <L7p:Base64ResponseBody stringValue="JHtyZXNwb25zZVhwYXRoLnJlc3VsdH0="/>
                                    </L7p:HardcodedResponse>
                                </wsp:All>
                                <L7p:HardcodedResponse>
                                    <L7p:Base64ResponseBody stringValue="PElGX1JFUExZPjxTRVJWSUNFX05BTUU+JHtzZXJ2aWNlbmFtZX08L1NFUlZJQ0VfTkFNRT48UkVRVUVTVF9TVEFUVVM+PFNUQVRVUz5FUlJPUjwvU1RBVFVTPjxTVEFUVVNfQ09ERT4tMTwvU1RBVFVTX0NPREU+PFNUQVRVU19NRVNTQUdFPlVuYWJsZSB0byByZXRyaWV2ZSByZXNwb25zZSAyLjwvU1RBVFVTX01FU1NBR0U+PC9SRVFVRVNUX1NUQVRVUz48L0lGX1JFUExZPg=="/>
                                </L7p:HardcodedResponse>
                            </wsp:OneOrMore>
                        </wsp:All>
                        <L7p:HardcodedResponse>
                            <L7p:Base64ResponseBody stringValue="PElGX1JFUExZPjxTRVJWSUNFX05BTUU+JHtzZXJ2aWNlbmFtZS5tYWlucGFydH08L1NFUlZJQ0VfTkFNRT48UkVRVUVTVF9TVEFUVVM+PFNUQVRVUz5FUlJPUjwvU1RBVFVTPjxTVEFUVVNfQ09ERT4tMTwvU1RBVFVTX0NPREU+PFNUQVRVU19NRVNTQUdFPlVuYWJsZSB0byByZXRyaWV2ZSByZXNwb25zZS48L1NUQVRVU19NRVNTQUdFPjwvUkVRVUVTVF9TVEFUVVM+PC9JRl9SRVBMWT4="/>
                        </L7p:HardcodedResponse>
                    </wsp:OneOrMore>
                    <L7p:assertionComment>
                        <L7p:Properties mapValue="included">
                            <L7p:entry>
                                <L7p:key stringValue="RIGHT.COMMENT"/>
                                <L7p:value stringValue="Retry action"/>
                            </L7p:entry>
                        </L7p:Properties>
                    </L7p:assertionComment>
                </wsp:All>
                <L7p:HardcodedResponse>
                    <L7p:AssertionComment assertionComment="included">
                        <L7p:Properties mapValue="included">
                            <L7p:entry>
                                <L7p:key stringValue="LEFT.COMMENT"/>
                                <L7p:value stringValue="ELSE: "/>
                            </L7p:entry>
                        </L7p:Properties>
                    </L7p:AssertionComment>
                    <L7p:Base64ResponseBody stringValue="PElGX1JFUExZPjxTRVJWSUNFX05BTUU+JHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLnNlcnZpY2VOYW1lfTwvU0VSVklDRV9OQU1FPjxSRVFVRVNUX1NUQVRVUz48U1RBVFVTPkVSUk9SPC9TVEFUVVM+PFNUQVRVU19DT0RFPi0xPC9TVEFUVVNfQ09ERT48U1RBVFVTX01FU1NBR0U+Tm8gdmFsaWQgQWN0aW9uIGRlZmluZWQ8L1NUQVRVU19NRVNTQUdFPjwvUkVRVUVTVF9TVEFUVVM+PC9JRl9SRVBMWT4="/>
                </L7p:HardcodedResponse>
                <L7p:AuditDetailAssertion>
                    <L7p:CustomLoggerSuffix stringValue="LogToSplunk"/>
                    <L7p:Detail stringValue="Latency serviceName=LegacyIFService runtime=${legacyIFRunTime} "/>
                    <L7p:LoggingOnly booleanValue="true"/>
                </L7p:AuditDetailAssertion>
            </wsp:OneOrMore>
        </wsp:All>
    </wsp:Policy>
</exp:Export>
